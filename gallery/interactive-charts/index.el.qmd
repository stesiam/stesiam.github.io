---
title: "Î”Î¹Î±Î´ÏÎ±ÏƒÏ„Î¹ÎºÎ¬ Î´Î¹Î±Î³ÏÎ¬Î¼Î¼Î±Ï„Î±"
description: "A collection of my visualizations. Some of them are based on popular challenges such as #TidyTuesday and #30DayMapChallenge. The collection is not restricted to those, as I find from time to time interesting datasets to work with."
link-external-newwindow: true
page-layout: full
comments: false
lang: el
title-block-banner: true
toc: true
column: body
---

## 30 Day Chart Challenge

### Î Ï‰Î»Î®ÏƒÎµÎ¹Ï‚ Î±Î»Ï…ÏƒÎ¯Î´Ï‰Î½ ÏƒÎ¿Ï…Ï€ÎµÏÎ¼Î¬ÏÎºÎµÏ„

```{r}
#| echo: false
#| message: false
library(highcharter)
library(glue)
library(dplyr)
library(tidyr)
library(stringr)
library(rvest)
library(jsonlite)
```

:::{.column-body}
```{r}
#| echo: false
#| warning: false
#| message: false
sm_sales = 14.8
data = data.frame(
  "Brand" = c("Î£ÎºÎ»Î±Î²ÎµÎ½Î¯Ï„Î·Ï‚", "LIDL", "AB Î’Î±ÏƒÎ¹Î»ÏŒÏ€Î¿Ï…Î»Î¿Ï‚", "ÎœÎ­Ï„ÏÎ¿ Î‘Î•Î’Î•", "ÎœÎ±ÏƒÎ¿ÏÏ„Î·Ï‚", "ÎšÏÎ·Ï„Î¹ÎºÏŒÏ‚","Î†Î»Î»Î¿"),
  "Sales" = c(5.35, 2, 1.94, 1.65, 1.15, 0.78, round(sm_sales - 5.35 - 2 - 1.94 - 1.65 - 1.15 - 0.78, digits = 2)),
  "Image" = c("https://www.sklavenitis.gr/favicon.ico", 
              "https://www.lidl-hellas.gr/static/assets/lidl-onlineshop-hellas-271731.svg", 
              "https://static.ab.gr/static/next/icons/favicon.png",
              "https://www.metrocashandcarry.gr/assets/img/logo_metro.svg",
              "https://upload.wikimedia.org/wikipedia/commons/thumb/8/8f/%CE%9C%CE%B1%CF%83%CE%BF%CF%8D%CF%84%CE%B7%CF%82_%28logo%29.svg/250px-%CE%9C%CE%B1%CF%83%CE%BF%CF%8D%CF%84%CE%B7%CF%82_%28logo%29.svg.png",
              "https://kritikos-sm.gr/assets/kritikos/logo.svg", NA),
  stringsAsFactors = F
) %>%
  mutate(pct = round((Sales/sum(Sales))*100, digits = 2))

title_text_gr = glue("<b>Î¤Î¶Î¯ÏÎ¿Ï‚ Î•Î»Î»Î·Î½Î¹ÎºÏÎ½ Î£Î¿Ï…Ï€ÎµÏÎ¼Î¬ÏÎºÎµÏ„ (2022)</b>")
subtitle_text_gr = glue( "Î£ÏÎ¼Ï†Ï‰Î½Î± Î¼Îµ Ï„Î· Ï„ÎµÎ»ÎµÏ…Ï„Î±Î¯Î± Î­ÎºÎ¸ÎµÏƒÎ· Ï„Î¿Ï… Î™Î•Î›ÎšÎ‘, Î¿Î¹ ÏƒÏ…Î½Î¿Î»Î¹ÎºÎ­Ï‚ Ï€Ï‰Î»Î®ÏƒÎµÎ¹Ï‚ Î±Î½Î­ÏÏ‡Î¿Î½Ï„Î±Î¹ ÏƒÏ„Î± â‚¬ <b>11.2</b> Î´Î¹Ï‚.
                         ÎŸ Î£ÎºÎ»Î±Î²ÎµÎ½Î¯Ï„Î·Ï‚ Î±Ï€Î¿Ï„ÎµÎ»ÎµÎ¯ Ï„Î·Î½ ÎºÏ…ÏÎ¯Î±ÏÏ‡Î· Î±Î»Ï…ÏƒÎ¯Î´Î± ÏƒÎ¿ÏÏ€ÎµÏÎ¼Î±ÏÎºÎµÏ„ ÎºÎ±Ï„Î­Ï‡Î¿Î½Ï„Î±Ï‚ Ï€Î¬Î½Ï‰ Î±Ï€ÏŒ Ï„Î¿ Î­Î½Î± Ï„ÏÎ¯Ï„Î¿ Ï„Î·Ï‚ Î±Î³Î¿ÏÎ¬Ï‚." )
caption_text_gr = glue("30 Day Chart Challenge, Day 1 (2024) <br> 
                    <b> Î”ÎµÎ´Î¿Î¼Î­Î½Î±:</b> Î Î±Î½ÏŒÏÎ±Î¼Î± ÎµÎ»Î»Î·Î½Î¹ÎºÏÎ½ ÏƒÎ¿Ï…Ï€ÎµÏÎ¼Î¬ÏÎºÎµÏ„, selfservice.gr | 
                    <b>Î“ÏÎ¬Ï†Î·Î¼Î±:</b> stesiam, 2024")

data_list <- purrr::pmap(data, function(Brand, Sales, Image, pct) {
  if (is.na(Image)) img <- NULL
  list(name = Brand, y = Sales, img = Image, perc = pct)
})

# Create the pie chart
highchart() %>%
  hc_add_dependency("modules/accessibility") %>%
  hc_chart(type = "pie") %>%
  hc_title(text = title_text_gr) %>%
  hc_subtitle(text = subtitle_text_gr) %>%
  hc_caption(text = caption_text_gr, useHTML = TRUE) %>%
  hc_series(
    list(
      name = "Sales",
      colorByPoint = TRUE,
      data = data_list
    )
  ) %>%
  hc_tooltip(
    valueDecimals = 2,
    useHTML = TRUE,
    style = list(width = "150px"), # Prevent overflow
    formatter = JS("
      function() {
        return '<div style=\"text-align:center; max-width:140px; \">' +
                 '<img src=\"' + this.point.img + '\" ' +
                 'style=\"max-width:100%; height:50px; border-radius:8px; display:block; margin:auto;\" /><br>' +
                 '<b>' + this.point.name + '</b><br>' +
                 'Î Ï‰Î»Î®ÏƒÎµÎ¹Ï‚: ' + this.point.y + ' Î´Î¹Ï‚ â‚¬<br>' +
                  'ÎœÎµÏÎ¯Î´Î¹Î¿ Î±Î³Î¿ÏÎ¬Ï‚: ' + this.point.perc + ' %<br>' +
               '</div>';
      }
    ")
  )
```
:::

### Î£Ï„ÏŒÎ»Î¿Ï‚ Î¿Ï‡Î·Î¼Î¬Ï„Ï‰Î½

```{r}
#| echo: false
#| warning: false
#| message: false
#| include: false
#| label: fig-dsfs
# url = "https://www.statistics.gr/el/statistics?p_p_id=documents_WAR_publicationsportlet_INSTANCE_Mr0GiQJSgPHd&p_p_lifecycle=2&p_p_state=normal&p_p_mode=view&p_p_cacheability=cacheLevelPage&p_p_col_id=column-2&p_p_col_count=4&p_p_col_pos=3&_documents_WAR_publicationsportlet_INSTANCE_Mr0GiQJSgPHd_javax.faces.resource=document&_documents_WAR_publicationsportlet_INSTANCE_Mr0GiQJSgPHd_ln=downloadResources&_documents_WAR_publicationsportlet_INSTANCE_Mr0GiQJSgPHd_documentID=116414&_documents_WAR_publicationsportlet_INSTANCE_Mr0GiQJSgPHd_locale=el"
# download.file(url, destfile = "text.xlsx")

options(highcharter.lang = list(
  numericSymbols = c("Ï‡Î¹Î».", "ÎµÎº.", "Î´Î¹Ïƒ.", "Ï„ÏÎ¹Ï‚.", "Ï„ÎµÏ„Ï.", "Ï€ÎµÎ½Ï„.")
))

vehicles_in_operation = readxl::read_excel("text.xlsx",
                                           range = "A3:V37")

dataset_part_1 = vehicles_in_operation[1:16, -1]
dataset_part_2 = vehicles_in_operation[18:34,-1]

#Use the first row of dataset as my variable names and delete the duplicated line

colnames(dataset_part_2) = dataset_part_2[1,]
dataset_part_2 = dataset_part_2[-1,]
# Remove duplicated columns

dataset_part_1 = dataset_part_1 %>%
  relocate(`Category and use`, .before = "1985")

dataset_part_2 = dataset_part_2[,-ncol(dataset_part_2)]

# Bind columns along each other

bind_dataset = dplyr::bind_cols(dataset_part_1, dataset_part_2)

## Now it's time to tidy my original dataset

dataset = bind_dataset %>%
  slice(c(1, 2, 6, 9, 12)) %>%
  rename(
    "category" = `Category and use`
  ) %>%
  mutate(category = case_when(
    grepl("Vehicles", category) ~ "Total",
    grepl("cars", category) ~ "Car",
    grepl("Buses", category) ~ "Bus",
    grepl("Motorcycle", category) ~ "Motorcycle",
    grepl("Truck", category) ~ "Truck",
    TRUE ~ category  # Keep other values unchanged
  )) %>%
  dplyr::filter(category != "Total")


df_wide = dataset %>%
  tidyr::pivot_longer(., cols = c(!category), names_to = "Year", values_to = "Obs") %>%
  pivot_wider(names_from = category, values_from = Obs) %>%
  mutate(Year = as.integer(Year)) %>%
  arrange(Year)

title_text_gr = "ÎŸÏ‡Î®Î¼Î±Ï„Î± ÏƒÏ„Î·Î½ Î•Î»Î»Î¬Î´Î±"
subtitle_text_gr = glue("Î Î±ÏÎ±Ï„Î·ÏÎ¿ÏÎ¼Îµ ÏŒÏ„Î¹ Ï„Î± Ï€ÏÏŒÏƒÏ†Î±Ï„Î± Ï‡ÏÏŒÎ½Î¹Î±
                     Ï…Ï€Î¬ÏÏ‡ÎµÎ¹ <span style = 'font-family:uc; color:red;'>3x</span><span style = 'font-family:fs; color:red;'> &#xe098; </span> Ï„Ï‰Î½ ÏƒÏ…Î½Î¿Î»Î¹ÎºÏÎ½ Î¿Ï‡Î·Î¼Î¬Ï„Ï‰Î½.
                     Î— Ï€Î¹Î¿ Î±Î¾Î¹Î¿ÏƒÎ·Î¼ÎµÎ¯Ï‰Ï„Î· Î±Î»Î»Î±Î³Î® ÎµÎ¯Î½Î±Î¹ Î¿
                     Î´Î¹Ï€Î»Î±ÏƒÎ¹Î±ÏƒÎ¼ÏŒÏ‚ Ï„Î¿Ï… Ï€Î¿ÏƒÎ¿ÏƒÏ„Î¿Ï Ï„Ï‰Î½ Î¼Î·Ï‡Î±Î½ÏÎ½")
caption_text_gr = "30 Day Chart Challenge, Day 15 (2024) | <b> Î”ÎµÎ´Î¿Î¼Î­Î½Î±:</b> Î•Î»Î»Î·Î½Î¹ÎºÎ® Î£Ï„Î±Ï„Î¹ÏƒÏ„Î¹ÎºÎ® Î¥Ï€Î·ÏÎµÏƒÎ¯Î±<br><span style='font-family:fb;'  >&#xf09b;</span> <b>stesiam</b>, 2024"


pal=c("#ffa600",
      "#2f4b7c",
      "#f95d6a",
      "#a05195")
```

```{r}
#| echo: false
highchart() %>%
    hc_chart(type = "area") %>%
    hc_title(text = title_text_gr) %>%
    hc_subtitle(text = subtitle_text_gr) %>%
    hc_caption(text = caption_text_gr) %>%
    hc_xAxis(categories = df_wide$Year,
             title = list(text = "Year")) %>%
    hc_yAxis(title = list(text = "Î Î¿Î±Î¿ÏƒÏ„ÏŒ (%)")) %>%
    hc_tooltip(shared = TRUE) %>%
    hc_plotOptions(area = list(
        stacking = "normal",  # or "percent" for percent stacked
        lineColor = "#666666",
        lineWidth = 1,
        marker = list(
            lineWidth = 1,
            lineColor = "#666666"
        )
    )) %>%
    hc_add_series(name = "Î‘Ï…Ï„Î¿ÎºÎ¯Î½Î·Ï„Î¿", data = df_wide$Car, color = "#2f4b7c") %>%
    hc_add_series(name = "Î›ÎµÏ‰Ï†Î¿ÏÎµÎ¯Î¿", data = df_wide$Bus, color = "#ffa600") %>%
    hc_add_series(name = "Î¦Î¿ÏÏ„Î·Î³ÏŒ", data = df_wide$Truck, color = "#a05195") %>%
    hc_add_series(name = "ÎœÎ·Ï‡Î±Î½Î®", data = df_wide$Motorcycle, color = "#f95d6a") %>%  hc_plotOptions(area = list(
        stacking = "percent",
        marker = list(enabled = FALSE)  # â† disables the pointers
    ))
```


```{r}
#| echo: false
highchart() %>%
    hc_chart(type = "area") %>%
    hc_title(text = title_text_gr) %>%
    hc_subtitle(text = subtitle_text_gr) %>%
    hc_caption(text = caption_text_gr) %>%
    hc_xAxis(categories = df_wide$Year,
             title = list(text = "Year")) %>%
    hc_yAxis(title = list(text = "Î Î»Î®Î¸Î¿Ï‚ Î¿Ï‡Î·Î¼Î¬Ï„Ï‰Î½")) %>%
   hc_tooltip(shared = TRUE) %>%
    hc_plotOptions(area = list(
        stacking = "normal",  # or "percent" for percent stacked
        lineColor = "#666666",
        lineWidth = 1,
        marker = list(
            lineWidth = 1,
            lineColor = "#666666"
        )
    )) %>%
    hc_add_series(name = "Î‘Ï…Ï„Î¿ÎºÎ¯Î½Î·Ï„Î¿", data = df_wide$Car, color = "#2f4b7c") %>%
    hc_add_series(name = "Î›ÎµÏ‰Ï†Î¿ÏÎµÎ¯Î¿", data = df_wide$Bus, color = "#ffa600") %>%
    hc_add_series(name = "Î¦Î¿ÏÏ„Î·Î³ÏŒ", data = df_wide$Truck, color = "#a05195") %>%
    hc_add_series(name = "ÎœÎ·Ï‡Î±Î½Î®", data = df_wide$Motorcycle, color = "#f95d6a") %>%  hc_plotOptions(area = list(
        stacking = "normal",
        marker = list(enabled = FALSE)  # â† disables the pointers
    ))
```


### ÎšÏÏ€ÎµÎ»Î»Î¿ Î Î¿Î´Î¿ÏƒÏ†Î±Î¯ÏÎ¿Ï… Î•Î»Î»Î¬Î´Î±Ï‚


```{r}
#| echo: false
#| warning: false
#| message: false
#| column: body-outset-left
library(dplyr)
library(stringr)
library(rvest)
library(jsonlite)
library(highcharter)
library(forcats)


url = "https://en.wikipedia.org/wiki/Greek_Football_Cup"

html <- read_html(url)

df <- data.frame(html %>% 
                   html_element("table.wikitable.sortable") %>% 
                   html_table()) %>%
  select(Club, Winners, Runners.up) %>%
  dplyr::filter(Winners >=1) %>%
  mutate(Image = case_when(
    Club == "Olympiacos" ~ "https://upload.wikimedia.org/wikipedia/en/thumb/a/a2/Olympiacos_FC_crest.svg/250px-Olympiacos_FC_crest.svg.png",
    Club == "Panathinaikos"   ~ "https://upload.wikimedia.org/wikipedia/en/thumb/8/84/Panathinaikos_F.C._logo.svg/250px-Panathinaikos_F.C._logo.svg.png",
    Club == "AEK"   ~ "https://upload.wikimedia.org/wikipedia/en/thumb/0/04/AEK_Athens_FC_logo.svg/155px-AEK_Athens_FC_logo.svg.png",
    Club == "PAOK"   ~ "https://upload.wikimedia.org/wikipedia/en/thumb/e/e6/PAOK_FC_EMBLEM.png/250px-PAOK_FC_EMBLEM.png",
    Club == "Panionios"   ~ "https://upload.wikimedia.org/wikipedia/en/thumb/7/70/Panionios_FC.png/250px-Panionios_FC.png",
    Club == "AEL"   ~ "https://upload.wikimedia.org/wikipedia/en/thumb/8/8e/AEL1964-Crest.svg/120px-AEL1964-Crest.svg.png",
    Club == "Aris"   ~ "https://upload.wikimedia.org/wikipedia/en/thumb/e/e4/Aris_Thessaloniki_F.C._logo.svg/130px-Aris_Thessaloniki_F.C._logo.svg.png",
    Club == "Iraklis"   ~ "https://upload.wikimedia.org/wikipedia/en/thumb/a/a9/IraklisSportNewLogo.png/250px-IraklisSportNewLogo.png",
    Club == "OFI"   ~ "https://upload.wikimedia.org/wikipedia/en/thumb/7/7f/OFI_emblem.png/250px-OFI_emblem.png",
    Club == "Ethnikos"   ~ "https://upload.wikimedia.org/wikipedia/en/thumb/4/4f/Ethnikos_Piraeus_FC_logo.png/250px-Ethnikos_Piraeus_FC_logo.png",
    Club == "Kastoria"   ~ "https://upload.wikimedia.org/wikipedia/en/thumb/e/eb/Kastoria_1980.png/250px-Kastoria_1980.png",
    TRUE                    ~ NA_character_
  )) %>% 
  dplyr::mutate(
    Runners.up = stringr::str_remove_all(Runners.up, "\\[.*")
  ) %>%
  dplyr::mutate(Runners.up = as.numeric(Runners.up)) %>%
  dplyr::arrange(-Winners) %>%
  mutate(Club = fct_recode(Club,
    "Î‘Î•Îš" = "AEK",
    "Î‘Î•Î›" = "AEL",
    "Î†ÏÎ·Ï‚" = "Aris",
    "Î•Î¸Î½Î¹ÎºÏŒÏ‚" = "Ethnikos",
    "Î—ÏÎ±ÎºÎ»Î®Ï‚" = "Iraklis",
    "ÎšÎ±ÏƒÏ„Î¿ÏÎ¹Î¬" = "Kastoria",
    "ÎŸÎ¦Î—" = "OFI",
    "ÎŸÎ»Ï…Î¼Ï€Î¹Î±ÎºÏŒÏ‚" = "Olympiacos",
    "Î Î±Î½Î±Î¸Î·Î½Î±ÏŠÎºÏŒÏ‚" = "Panathinaikos",
    "Î Î±Î½Î¹ÏÎ½Î¹Î¿Ï‚" = "Panionios",
    "Î Î‘ÎŸÎš" = "PAOK"
  ))

image_js <- toJSON(df$Image, auto_unbox = TRUE)

title_text_gr = glue("ÎÎ¹ÎºÎ·Ï„Î­Ï‚ ğŸ† ÎºÏ…Ï€Î­Î»Î»Î¿Ï… Î•Î»Î»Î¬Î´Î±Ï‚ ÏƒÏ„Î¿ Ï€Î¿Î´ÏŒÏƒÏ†Î±Î¹ÏÎ¿ âš½")
subtitle_text_gr = glue("ÎŸ ÎŸÎ»Ï…Î¼Ï€Î¹Î±ÎºÏŒÏ‚ ÎµÎ¯Î½Î±Î¹ Î· Î¿Î¼Î¬Î´Î± Î¼Îµ Ï„Î¹Ï‚ Ï€ÎµÏÎ¹ÏƒÏƒÏŒÏ„ÎµÏÎµÏ‚ ÎºÎ±Ï„Î±ÎºÏ„Î®ÏƒÎµÎ¹Ï‚ (29) ÏƒÏ„Î¿ ÎºÏÏ€ÎµÎ»Î»Î¿ Î•Î»Î»Î¬Î´Î±Ï‚")
caption_text_gr = glue("30 Day Chart Challenge, Day 4 | <b>Data:</b> Wikipedia | <b>Graph:</b> stesiam, 2024")

highchart() %>%
  hc_chart(type = "bar") %>%
  hc_title(text = title_text_gr) %>%
  hc_subtitle(text = subtitle_text_gr) %>%
  hc_caption(text = caption_text_gr) %>%
  hc_xAxis(title = list(text = NULL), categories = df$Club) %>%
  hc_yAxis(title = list(text = "ÎšÎ±Ï„Î±ÎºÏ„Î®ÏƒÎµÎ¹Ï‚ ÎºÏ…Ï€Î­Î»Î»Î¿Ï…")) %>%
  hc_plotOptions(bar = list(
    pointPadding = 0.05,
    groupPadding = 0.1,
    borderWidth = 0
  )) %>%
  hc_tooltip(
    useHTML = TRUE,
    style = list(
      fontSize = "12px",
      whiteSpace = "normal",
      padding = "10px",
      overflow = "visible",
      color = "#000"
    ),
    formatter = JS(sprintf("
    function() {
      const images = %s;
      return '<div style=\"display:flex; align-items:center; width:115px;\">' +
             '<img src=\"' + images[this.point.index] + '\" style=\"height:25px; margin-right:10px;\" />' +
             '<div><b>' + this.key + 
             '</b><br/>ÎšÎ±Ï„Î±ÎºÏ„Î®ÏƒÎµÎ¹Ï‚: ' + this.y + 
             '</div>' +
             
             '</div>';
    }
  ", image_js))
  )%>%
  hc_series(list(
    name = "ÎšÎ±Ï„Î±ÎºÏ„Î®ÏƒÎµÎ¹Ï‚",
    data = df$Winners
  )
  ) %>%
  hc_legend(enabled = FALSE)

```

### Î•ÏÎ³Î±Î»ÎµÎ¯Î± Î‘Î½Î¬Î»Ï…ÏƒÎ·Ï‚ Î”ÎµÎ´Î¿Î¼Î­Î½Ï‰Î½

```{r}
#| echo: false
#| warning: false
#| message: false
#| column: body-outset-left
library(readr)
library(dplyr)
library(tidyr)
library(glue)
library(highcharter)
library(lubridate)

data <- read_csv("AnalyticsTrends.csv", 
                 skip = 1)

data_edit = data %>%
  setNames(c("Month", "R", "SPSS", "MATLAB")) |>
  mutate(
    Month = lubridate::ym(Month),
    Year = year(Month)
  ) |>
  dplyr::relocate(Year, .before = "Month") |>
  select(-Month) |>
  tidyr::pivot_longer(
    cols = !c("Year")
  ) |>
  group_by(Year, name) |>
  summarise(
    mean = round(mean(value), digits = 1)
  ) %>%
  tidyr::pivot_wider(names_from = name, values_from = mean)

title_text = glue("Î¤Î¬ÏƒÎµÎ¹Ï‚ AÎ½Î±Î¶Î®Ï„Î·ÏƒÎ·Ï‚ Î•ÏÎ³Î±Î»ÎµÎ¯Ï‰Î½ Î‘Î½Î¬Î»Ï…ÏƒÎ·Ï‚")
subtitle_text = glue("Î•ÏÎµÏ…Î½ÏÎ½Ï„Î±Ï‚ Ï„Î¿ ÎµÎ½Î´Î¹Î±Ï†Î­ÏÎ¿Î½ Î±Î½Î±Î¶Î®Ï„Î·ÏƒÎ·Ï‚ Î³Î¹Î± Î»Î¿Î³Î¹ÏƒÎ¼Î¹ÎºÎ¬ Î® Î³Î»ÏÏƒÏƒÎµÏ‚ Ï€ÏÎ¿Î³ÏÎ±Î¼Î¼Î±Ï„Î¹ÏƒÎ¼Î¿Ï <br>ÎµÏ€Î¹ÎºÎµÎ½Ï„ÏÏ‰Î¼Î­Î½Î± ÏƒÏ„Î·Î½ Î±Î½Î¬Î»Ï…ÏƒÎ· Î´ÎµÎ´Î¿Î¼Î­Î½Ï‰Î½,
                     ÏƒÏ…Î¼Ï€ÎµÏÎ±Î¯Î½Ï‰ ÏŒÏ„Î¹ Î· <b><span style='color:#019b98;'>R</span></b> Î­Ï‡ÎµÎ¹ ÎºÎ±Î¸Î¹ÎµÏÏ‰Î¸ÎµÎ¯ ÏƒÏ„Î¿ Ï€ÎµÎ´Î¯Î¿ Ï„Î·Ï‚ Î±Î½Î¬Î»Ï…ÏƒÎ·Ï‚ Ï„Î· Ï„ÎµÎ»ÎµÏ…Ï„Î±Î¯Î± Î´ÎµÎºÎ±ÎµÏ„Î¯Î±
                     Î­Î½Î±Î½Ï„Î¹ Ï„Î¿Ï…  <b><span style='color:#F18F01;'>MATLAB</span></b> ÎºÎ±Î¹ Ï„Î¿Ï… <b><span style='color:#dd0025;'>SPSS</span></b>")
caption_text = "30 Day Chart Challenge, Day 28 (2024) | <b>Î”ÎµÎ´Î¿Î¼Î­Î½Î±:</b> Google Trends | <b>Î“ÏÎ¬Ï†Î·Î¼Î±:</b> stesiam, 2024"

highchart() %>%
  hc_chart(type = "line") %>%
  hc_title(text = title_text) %>%
  hc_subtitle(text = subtitle_text) %>%
  hc_caption(text = caption_text) %>%
  hc_xAxis(categories = data_edit$Year) %>%
  hc_add_series(name = "R", data = data_edit$R) %>%
  hc_add_series(name = "MATLAB", data = data_edit$MATLAB, color = "orange") %>%
  hc_add_series(name = "SPSS", data = data_edit$SPSS, color="#db9f92") %>%
  hc_tooltip(shared = TRUE) %>%
  hc_plotOptions(line = list(
    marker = list(enabled = FALSE)))
```

### ÎšÎ±Î¸Ï…ÏƒÏ„ÎµÏÎ·Î¼Î­Î½Î· Î‘Ï€Î¿Ï†Î¿Î¯Ï„Î·ÏƒÎ·

```{r}
#| echo: false
#| warning: false
#| message: false
library(dplyr)
library(tidyr)
library(glue)
library(stringr)
library(qpdf)
library(tabulapdf)

url = "https://www.unipi.gr/faculty/mbouts/anak/OS_22_23.pdf"

download.file(url,
              destfile = "sg22.pdf",
              method = "wget",
              extra = "--no-check-certificate")

pdf_subset('sg22.pdf',
           pages = 186:190,  output = "subset.pdf")

statistics_tables <- extract_tables(
  file   = "subset.pdf", 
  method = "decide", 
  output = "tibble")

graduate_data = statistics_tables[[5]] %>%
  setNames(c("Year", "4Y", "5Y", "6Y", "7Y", "8Y", "9Y", "10Y", "11Y+","AVGY")) %>%
  .[-c(1:2),] %>%
  drop_na() %>%
  dplyr::filter(Year != "2009-2022") %>%
  mutate(across(contains("Y") & !matches("^Year$"), as.numeric)) %>%
  mutate("4y" = `4Y`,
         "4to6" = `5Y` + `6Y`,
         "6to8" = `7Y` + `8Y`,
         "9plus" = `9Y` + `10Y` + `11Y+`) %>%
  select(Year, `4y`, `4to6`, `6to8`, `9plus`) %>%
  mutate(
    Year = stringr::str_replace(Year, ".*-", "")
  )


title_text = "Vehicle fleet mix in Greece "
subtitle_text = glue("In terms of proportions, cars consistently make up 7 out of every 10 vehicles. 
                     Since 2007, motorcycles have been the second most common type of vehicle,
                     followed by trucks.")
caption_text = "30 Day Chart Challenge, Day 15 (2024) | 
<b> Data:</b> Hellenic Statistical Authority | <b>Graph:</b> stesiam, 2024"

highchart() %>%
  hc_chart(type = "area") %>%
  hc_title(text = title_text) %>%
  hc_subtitle(text = subtitle_text) %>%
  hc_caption(text = caption_text) %>%
  hc_xAxis(categories = graduate_data$Year,
           title = NULL) %>%
  hc_yAxis(title = list(text = "Percentage (%)")) %>%
  hc_tooltip(shared = TRUE) %>%
  hc_plotOptions(area = list(
    stacking = "normal",  # or "percent" for percent stacked
    lineColor = "#666666",
    lineWidth = 1,
    marker = list(
      lineWidth = 1,
      lineColor = "#666666"
    )
  )) %>%
  hc_add_series(name = "9 Years +", data = graduate_data$`9plus`, color = "#ff1155") %>%
  hc_add_series(name = "7 to 8 Years", data = graduate_data$`6to8`, color = "#ffcccc") %>%
  hc_add_series(name = "5 to 6 Years", data = graduate_data$`4to6`, color = "#cce5ff") %>%
  hc_add_series(name = "4 Years", data = graduate_data$`4y`, color = "#3399ff") %>%
  hc_plotOptions(area = list(
    stacking = "percent",
    marker = list(enabled = FALSE)  # â† disables the pointers
  ))
```

## Greece in Figures

```{r}
#| echo: false
#| warning: false
#| message: false


library(dplyr)
library(readxl)
library(highcharter)
library(fuzzyjoin)
library(tidyr)
library(RColorBrewer)
library(tabulapdf)
library(qpdf)


download.file(
  url = "https://www.statistics.gr/en/statistics?p_p_id=documents_WAR_publicationsportlet_INSTANCE_Mr0GiQJSgPHd&p_p_lifecycle=2&p_p_state=normal&p_p_mode=view&p_p_cacheability=cacheLevelPage&p_p_col_id=column-2&p_p_col_count=4&p_p_col_pos=3&_documents_WAR_publicationsportlet_INSTANCE_Mr0GiQJSgPHd_javax.faces.resource=document&_documents_WAR_publicationsportlet_INSTANCE_Mr0GiQJSgPHd_ln=downloadResources&_documents_WAR_publicationsportlet_INSTANCE_Mr0GiQJSgPHd_documentID=115793&_documents_WAR_publicationsportlet_INSTANCE_Mr0GiQJSgPHd_locale=en",
  destfile = "pharmacies.xlsx"
)

download.file(url = "https://elstat-outsourcers.statistics.gr/census_results_2022_en.pdf",
              destfile = "census.pdf")

qpdf::pdf_subset(input = "census.pdf", pages = 6, output = "census_custom.pdf")

pharmacies_raw = read_excel("pharmacies.xlsx", 
                            sheet = "Î¦Î±ÏÎ¼Î±ÎºÎµÎ¯Î± 2010-2022") |>
  select(last_col(), last_col(1)) |>
  tidyr::drop_na() |>
  setNames(c("Region", "Pharmacies"))


extract_census <- extract_tables(
  file   = "census_custom.pdf", 
  method = "decide", 
  output = "tibble") %>%
  .[[1]]

regional_population = extract_census |>
  select(-1) |>
  select(1,3) |>
  setNames(c("Region", "Population")) |>
  mutate(
    Population = stringr::str_replace_all(Population, ",", "")
  ) |>
  tidyr::drop_na() |>
  mutate(
    Region = stringr::str_to_title(Region)
  ) |>
  slice(-nrow(statistics_tables[[1]]))

data_join = fuzzyjoin::stringdist_left_join(regional_population, pharmacies_raw,
                                            by = "Region",distance_col = "distance") |>
  rename(Region = Region.x) |>
  mutate(Pharmacies10000Capita = round(Pharmacies * 10000 / as.numeric(Population), digits = 2 )) |>
  select(Region, Pharmacies10000Capita) %>%
  add_row(Region = "Ayio Oros", Pharmacies10000Capita = NA)


mapdata <- get_data_from_map(download_map_data("countries/gr/gr-all")) |>
  rename(Region = "name")

matches <- stringdist_inner_join(
  mapdata, data_join,
  by = "Region",
  max_dist = 20,           # allow wider search, will filter later
  method = "jw",          # Jaro-Winkler similarity
  distance_col = "dist"   # store the distance
)

matches <- matches %>%
  mutate(similarity = 1 - dist)

best_matches <- matches %>%
  group_by(Region.x) %>%
  slice_max(similarity, n = 1, with_ties = FALSE) %>%
  ungroup() %>%
  rename(code = `hc-key`, 
         PER = `alt-name`)



hcmap("countries/gr/gr-all",
      data = best_matches,value = "Pharmacies10000Capita",
      joinBy = c("hc-key", "code"),
      name = "Î¦Î±ÏÎ¼Î±ÎºÎµÎ¯Î± Î±Î½Î¬ 100000 ÎºÎ±Ï„Î¿Î¯ÎºÎ¿Ï…Ï‚",
      dataLabels = list(enabled = FALSE)) |>
  hc_title(text = "Î‘ÏÎ¹Î¸Î¼ÏŒÏ‚ Ï†Î±Î¼ÏÎ±ÎºÎµÎ¯Ï‰Î½") |>
  hc_legend(enabled = FALSE) |>
  hc_colorAxis(
    stops = color_stops(n = 4, colors = brewer.pal(4, "YlGn")),
    min = min(best_matches$Pharmacies10000Capita, na.rm = TRUE),
    max = max(best_matches$Pharmacies10000Capita, na.rm = TRUE)
  ) |>
  hc_tooltip(
    useHTML = TRUE,
    pointFormat = '<b>{point.name}</b><br/>Î Î»Î®Î¸Î¿Ï‚ Ï†Î±ÏÎ¼Î±ÎºÎµÎ¯Ï‰Î½: {point.value}'
  )


library(highcharter)
library(fuzzyjoin)
library(dplyr)
library(RColorBrewer)
library(tidyr)

mapdata <- get_data_from_map(download_map_data("countries/gr/gr-all")) |>
  rename(PER = "alt-name")

dt = data.frame(
  PER = c("Macedonia East and Thrace","Macedonia Central","Macedonia West",
                          "Epirus", "Thessaly", "Aegean North", "Aegean South", "Greece Central",
                          "Greece West", "Peloponnese", "Ionian Islands", "Crete", "Attica", "Holy Mountain"),
  PERgr = c("Î‘Î½Î±Ï„Î¿Î»Î¹ÎºÎ® ÎœÎ±ÎºÎµÎ´Î¿Î½Î¯Î± ÎºÎ±Î¹ Î˜ÏÎ¬ÎºÎ·", "ÎšÎµÎ½Ï„ÏÎ¹ÎºÎ® ÎœÎ±ÎºÎµÎ´Î¿Î½Î¯Î±", "Î”Ï…Ï„Î¹ÎºÎ® ÎœÎ±ÎºÎµÎ´Î¿Î½Î¯Î±", "Î‰Ï€ÎµÎ¹ÏÎ¿Ï‚",
          "Î˜ÎµÏƒÏƒÎ±Î»Î¯Î±", "Î’ÏŒÏÎµÎ¹Î¿ Î‘Î¹Î³Î±Î¯Î¿", "ÎÏŒÏ„Î¹Î¿ Î‘Î¹Î³Î±Î¯Î¿", "Î£Ï„ÎµÏÎµÎ¬ Î•Î»Î»Î¬Î´Î±", "Î”Ï…Ï„Î¹ÎºÎ® Î•Î»Î»Î¬Î´Î±", "Î ÎµÎ»Î¿Ï€ÏŒÎ½Î½Î·ÏƒÎ¿Ï‚", 
          "Î™ÏŒÎ½Î¹Ï‰Î½ ÎÎ®ÏƒÏ‰Î½", "ÎšÏÎ®Ï„Î·", "Î‘Ï„Ï„Î¹ÎºÎ®", "Î†Î³Î¹Î¿ ÎŒÏÎ¿Ï‚"),
  gdp = c(11643, 13343, 14656, 
          12098, 13064, 11355, 
          18332, 15497, 12424, 
          14553, 16041, 14490, 
          23430, NA))

matches <- stringdist_inner_join(
  mapdata, dt,
  by = "PER",
  max_dist = 15,           # allow wider search, will filter later
  method = "lv",          # Jaro-Winkler similarity
  distance_col = "dist"   # store the distance
)

matches <- matches %>%
  mutate(similarity = 1 - dist)

best_matches <- matches %>%
  group_by(PER.x) %>%
  slice_max(similarity, n = 1, with_ties = FALSE) %>%
  ungroup() %>%
  rename(code = `hc-key`)

hcmap("countries/gr/gr-all",
      data = best_matches,value = "gdp",
      joinBy = c("hc-key", "code"),
      name = "ÎšÎ±Ï„Î¬ ÎºÎµÏ†Î±Î»Î®Î½ Î‘Î•Î ",
      dataLabels = list(enabled = FALSE)) |>
  hc_title(text = "ÎšÎ±Ï„Î¬ ÎºÎµÏ†Î±Î»Î®Î½ Î‘Î•Î  Î±Î½Î¬ Ï€ÎµÏÎ¹Ï†Î­ÏÎµÎ¹Î±") |>
  hc_legend(enabled = FALSE) |>
  hc_colorAxis(
    stops = color_stops(n = 4, colors = brewer.pal(4, "YlOrBr")),
    min = min(best_matches$gdp, na.rm = TRUE),
    max = max(best_matches$gdp, na.rm = TRUE)
  ) |>
  hc_tooltip(
             useHTML = TRUE,
             headerFormat = "",
           pointFormat = "<b>{point.PERgr}</b><br/>ÎšÎ±Ï„Î¬ ÎºÎµÏ†Î±Î»Î®Î½ Î‘Î•Î : {point.value} â‚¬"
         )
```



```{r}
#| echo: false
#| results: hide
#| warning: false

file.remove("census.pdf")
file.remove("census_custom.pdf")
file.remove("pharmacies.xlsx")
file.remove("sg22.pdf")
```

