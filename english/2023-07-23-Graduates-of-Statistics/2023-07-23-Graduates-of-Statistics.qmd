---
title: "Statistics of Statistics Graduates"
author: "stesiam"
description: |
  Extracting tabular data from PDF file, in order to explore facts about graduates of Statistics and Insurance Department in University of Piraeus
link-external-newwindow: true
categories: [R, EDA, PDF, tabulizer]
fig-cap-location: bottom
date: "2023-07-23"
freeze: true
image: graduation-cap.jpg
df_print: paged
image-alt: graduation cap
toc: true
toc-title: Table of contents
toc-location: left
citation: true
slug: stesiam2022
title-block-banner: true
nocite: '@*'
csl: apa-6th-edition.csl
bibliography: [packages.bib, references.bib]
format: 
  html:
    code-link: true
    code-fold: false
    code-summary: "Show the code"
    code-tools: 
      source: repo
    fig_retina: 1
execute:
  echo: true
editor_options: 
  markdown: 
    wrap: 80
---

```{r, include=FALSE}
here::here("english/2023-07-23-Graduates-of-Statistics")
```


## Introduction

The recent study guide includes data about the graduates and their average grade of graduation over the years. First and foremost the data we are interested in are included in table form (which is good) but is is part of a pdf file (which is not good :)). Thankfully, **tabulizer** is the solution to this kind of problems.


## Load Packages

As I will extract tables from a pdf file, I will definitely need **tabulizer** package. Unfortunately, I was not able to install the specific package, as I was getting an error similar to this [one](https://github.com/ropensci/tabulizer/issues/157). This issue seems to be related to rJava package and [this comment](https://github.com/s-u/rJava/issues/255#issuecomment-794473988) solved the issue. After installing rJava I was able to install successufully tabulizer as below:

```{r}
# remotes::install_github(c("ropensci/tabulizerjars", "ropensci/tabulizer"))
```



```{r Import R libraries, warning=F, message=FALSE}
library(rJava)
library(tabulizer)
library(dplyr)
library(pdftools)
library(tidyr)
library(reactable)

library(ggplot2)
library(ggtext)
library(showtext)

font_add_google("Lobster", "lobster")
font_add_google("Economica", "economica")
showtext_auto()
```


```{r Add references of R libraries, include=FALSE}
# Add loaded libraries to bibliography section

knitr::write_bib(.packages(), file = 'packages.bib')
```

## Extract Data

My main source of data is the Department's study guide. The most recent one (2022) has data on admissions, graduations etc., since 2004. It worths to note that there are irrelevant information that have to be elapsed beforehand.

```{r}
# url = "https://www.unipi.gr/faculty/mbouts/anak/OS_22_23.pdf"
# 
# download.file(url, 
#               destfile = "sg22.pdf",
#               method = "wget",
#               extra = "--no-check-certificate")

pdf_subset('sg22.pdf',
  pages = 186:190,  output = "subset.pdf")

```

```{r}
statistics_tables <- extract_tables(
    file   = "subset.pdf", 
    method = "decide", 
    output = "data.frame")
```

## Analysing Data

###  Admitted students

Data on admissions show an 

```{r, warning=FALSE}
admitted_students = statistics_tables[[1]] %>%
  .[-1,] %>%
  setNames(c("Year", "Main_exams", "Transfer", "Entry_exams", "Other", "Total"))

admitted_students$Main_exams = admitted_students$Main_exams %>% as.integer()
admitted_students$Transfer= admitted_students$Transfer %>% as.integer()
admitted_students$Entry_exams = admitted_students$Entry_exams %>% as.integer()
admitted_students$Other = admitted_students$Other %>% as.integer()

rownames(admitted_students) = 1:nrow(admitted_students)

admitted_students = admitted_students %>% 
  pivot_longer(
    cols = !Year, 
    names_to = "Admission_Type", 
    values_to = "count"
  )

admitted_students %>%
  reactable(
    defaultPageSize = 5
  )
```


```{r, fig.showtext = TRUE}
admitted_students %>%
  filter(Admission_Type %in% c("Main_exams", "Total")) %>%
  ggplot2::ggplot(., aes(x = Year, y = count, color = Admission_Type , group = Admission_Type)) +
  geom_line() +
  labs(
    title = "Admitted students",
    subtitle = "Admitted students over the years (2003-2023) at Department of Statistics and Insurance Science of <br> University of Piraeus. A significant drop in admissions occured in 2021 which is maily caused by the <br> introduction of grade requirements to be admitted to specific departments.",
    caption = "stesiam, 2023",
    x = "Academic Year",
    y = "Students",
    color = "Type of Admission"
  ) +
  theme_classic() +
  theme(
    plot.title = element_markdown(family = "lobster", face="bold"),
    plot.subtitle = element_markdown(family = "economica"),
    plot.caption = element_markdown(family = "economica"),
    axis.text.x = element_text(face="bold", angle=90)
  )
```

### Master Programmes



Department of Statistics and Isurance Science has 2 master programs 

```{r}
msc_students = statistics_tables[[2]] %>%
  setNames(c("AcademicYear", "BSc", "MSc (AppliedStat)", "MSc (Actuar)", "PhD")) %>%
  .[-1,]

rownames(msc_students) = 1:nrow(msc_students)

msc_students = msc_students %>%
  mutate_at(c("BSc", "MSc (AppliedStat)", "MSc (Actuar)", "PhD"), as.numeric) %>%
  mutate(pct = round((PhD/BSc)*100, 2))

msc_students %>%
  reactable(
    defaultPageSize = 5
  )
```

```{r}
ggplot(msc_students, aes(x = AcademicYear, y = pct, group = 1)) +
  geom_line() +
  labs(
    title = "Ratio of PhD students/ Undergraduates",
    subtitle = "The decrease ",
    caption = "stesiam, 2023"
  ) +
  theme_classic() +
  theme(
    plot.title = element_markdown(family = "serif", face="bold"),
    plot.subtitle = element_markdown(family = "serif"),
    plot.caption = element_markdown(family = "serif"),
    axis.text.x = element_text(face="bold", angle=90)
  )
```

```{r}
tidy_students = msc_students %>%
  select(!pct) %>%
  tidyr::pivot_longer(., cols = !c(AcademicYear), values_to = "count")

ggplot(tidy_students, aes(x = AcademicYear, y = count, fill = name)) +
  geom_col() +
  guides(fill = guide_legend(reverse = TRUE)) +
  labs(
    title = "Ratio of PhD students/ Undergraduates",
    subtitle = "The decrease ",
    caption = "stesiam, 2023",
    x = "",
    y = ""
  ) +
  theme_classic() +
  theme(
    plot.title = element_markdown(family = "serif", face="bold"),
    plot.subtitle = element_markdown(family = "serif"),
    plot.caption = element_markdown(family = "serif"),
    axis.text.x = element_text(face="bold", angle=90)
  )
```

## MSc Students

```{r}
statistics_tables[[3]] %>%
  select(c(1,2)) %>%
  setNames(c("Year", "S")) %>%
  .[-c(1,2),] %>%
  separate(S, c('Admitted', 'Graduated')) %>%
  na.omit() %>%
  mutate(Ratio = round(as.numeric(Graduated)/as.numeric(Admitted), 2)) %>%
  select(Year, Ratio) %>%
  ggplot(.) +
  geom_line(aes(x = Year, y = Ratio, group = 1))+
  theme_classic()
  
```


## Graduation Grade

```{r}
statistics_tables[[4]] %>%
  setNames(c("Year", "[5.0 - 6)", "[6, 7)", "X3", "(", "AVG_Grade"))
  
  
```



## Acknowledgements {.appendix .unlisted}

Dataset based on recent study guide <a href="https://www.unipi.gr/faculty/mbouts/anak/OS_22_23.pdf">recent study guide</a> of Department of Statistics and Insurance Science of the University of Piraeus.

Image by <a href="https://pixabay.com/users/vloveland-4834409/?utm_source=link-attribution&utm_medium=referral&utm_campaign=image&utm_content=2148715">Victoria Loveland</a> from <a href="https://pixabay.com//?utm_source=link-attribution&utm_medium=referral&utm_campaign=image&utm_content=2148715">Pixabay</a>


## References {.appendix .unlisted}