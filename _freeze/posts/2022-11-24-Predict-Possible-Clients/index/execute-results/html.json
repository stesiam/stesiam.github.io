{
  "hash": "1eff18f0ffc7f3ffd436c105ffdfb236",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"Predict Possible Interested Clients\"\nauthor: \"stesiam\"\nlang: en\ndescription: |\n  Build a classification machine learning model (using LightGBM & XGBoost) in order to classify people based on their interest to have a term deposit or not.\nfreeze: true\nlink-external-newwindow: true\ncategories: [R, Classification, Tidymodels]\nimage: client_predict.jpg\nimage-alt: Îœagnifying glass shows human figures\nfig-cap-location: bottom\ndate: \"2022-11-24\"\ntoc: true\ntoc-title: Table of Contents\ntoc-location: left\ncitation: true\ntitle-block-banner: true\nnocite: '@*'\ncsl: apa-6th-edition.csl\nbibliography: [packages.bib, references.bib]\nformat: \n  html:\n    freeze: true\n    code-link: true\n    code-fold: true\n    code-summary: \"Show the code\"\n    code-tools: \n      source: https://github.com/stesiam/stesiam.github.io/blob/gh-pages/english-posts/2022-11-24-Predict-Possible-Clients/index.qmd\nexecute:\n  echo: true\neditor_options: \n  markdown: \n    wrap: 80\n---\n\n\n\n\n# Introduction\n\nOn this article, I will make a ML model, in order to predict the costumers of a bank that are interested on having a term deposit. To achieve this goal I will use some Boosting algorithms (XGBoost and LightGBM). The data is from UCI website [@Dua2019] and the dataset that I worked with is \"Bank Marketing\" [@moro2014data].\n\nBut first let's explain some things.\n\n> What is a term deposit ?\n\nGenerally, we are saving our money in a bank account but we are promising to not withdraw them for a specific amount of time. \n\n\n> And why someone to do that ?\n\nIt is apparent that term deposits have a major disadvantage over regular ones in terms of capital availability. Of course, people will not have motive to do that without anything in return. For that reason, the banks usually offer higher interest for that kind of accounts. For example, Piraeus Bank (a bank in Greece) offers double interest rate on term deposits compared to regular ones.\n\nSo, we can assume that there will be a serious interest for that product mostly on people with significant amount of savings ($>1000$) and do not have large, extraordinary expenses (loan, kids, etc.). \n\n# Prerequisites\n\n## Import libraries\n\nFor this analysis we will need standard libraries for importing and processing my data, such as readr [@R-readr] and dplyr [@R-dplyr]. The kableExtra [@R-kableExtra] package was used to print the results in table format. Concerning general purpose R libraries, I also used gridExtra in order to show ggplot items side to side. \n\nOn its basis this analysis is about to predict if someone is interested or not to have a term deposit. Thus, we need to build a ML model. The all-in-one solution package tidymodels is crucial to this. Although, there are some concerns about our data (imbalanced predicted value and our implementation of LightGBM. Thankfully, these are solved by bonsai and treesnip packages, respectively.\n\nFinally, the ggplot2 [@R-ggplot2] package was used to create some visualizations, as well as an auxiliary package, ggtext [@R-ggtext], for further formatting those.\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# General purpose R libraries\nlibrary(readr)\nlibrary(dplyr)\nlibrary(forcats)\nlibrary(kableExtra)\nlibrary(gridExtra)\n\n# Build ML models\nlibrary(tidymodels)\n\n# Graphs\nlibrary(ggplot2)\nlibrary(ggtext) # Add support for HTML/CSS on ggplot\n\n# Other R packages\nlibrary(fontawesome)\n\n\n# Build ML models\n\nlibrary(tidymodels)\nlibrary(bonsai)\nlibrary(themis)\n\n# Other settings\noptions(digits=4) # print only 4 decimals\noptions(warn = -1)\n```\n:::\n\n\n\n\n\n\n## Import dataset\n\nAfter loading R libraries, then I will load my data. The initial source of my dataset has various versions of the same dataset. I will use the smaller one, as the fitting process on Boosting algorithms it is more time consuming in comparison with other methods (e.g. Logistic Regression, k-Nearest Neighbours etc.).\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nbank_dataset <- read_delim(\"bank_dataset_files/bank.csv\",  delim = \";\", escape_double = FALSE, trim_ws = TRUE)\n\nbank_dataset = bank_dataset %>% tibble::rowid_to_column(\"ID\")\n```\n:::\n\n\n\n\n## Preview dataset\n\nHere we can see a small chunk of my dataset (first 10 rows / observations) just to understand the dataset's structure and type of variables.\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n#| label: tbl-preview-dataset\n#| tbl-cap: \"Preview Dataset (first 6 rows)\"\n#| \npreview_bank_dataset = head(bank_dataset, 10)\nkbl(preview_bank_dataset, \n    align = 'c',\n    booktabs = T,\n    centering = T,\n    valign = T) %>%\n  kable_paper() %>%\n  scroll_box(width = \"600px\", height = \"250px\")\n```\n\n::: {.cell-output-display}\n`````{=html}\n<div style=\"border: 1px solid #ddd; padding: 0px; overflow-y: scroll; height:250px; overflow-x: scroll; width:600px; \"><table class=\" lightable-paper\" style='font-family: \"Arial Narrow\", arial, helvetica, sans-serif; margin-left: auto; margin-right: auto;'>\n <thead>\n  <tr>\n   <th style=\"text-align:center;position: sticky; top:0; background-color: #FFFFFF;\"> ID </th>\n   <th style=\"text-align:center;position: sticky; top:0; background-color: #FFFFFF;\"> age </th>\n   <th style=\"text-align:center;position: sticky; top:0; background-color: #FFFFFF;\"> job </th>\n   <th style=\"text-align:center;position: sticky; top:0; background-color: #FFFFFF;\"> marital </th>\n   <th style=\"text-align:center;position: sticky; top:0; background-color: #FFFFFF;\"> education </th>\n   <th style=\"text-align:center;position: sticky; top:0; background-color: #FFFFFF;\"> default </th>\n   <th style=\"text-align:center;position: sticky; top:0; background-color: #FFFFFF;\"> balance </th>\n   <th style=\"text-align:center;position: sticky; top:0; background-color: #FFFFFF;\"> housing </th>\n   <th style=\"text-align:center;position: sticky; top:0; background-color: #FFFFFF;\"> loan </th>\n   <th style=\"text-align:center;position: sticky; top:0; background-color: #FFFFFF;\"> contact </th>\n   <th style=\"text-align:center;position: sticky; top:0; background-color: #FFFFFF;\"> day </th>\n   <th style=\"text-align:center;position: sticky; top:0; background-color: #FFFFFF;\"> month </th>\n   <th style=\"text-align:center;position: sticky; top:0; background-color: #FFFFFF;\"> duration </th>\n   <th style=\"text-align:center;position: sticky; top:0; background-color: #FFFFFF;\"> campaign </th>\n   <th style=\"text-align:center;position: sticky; top:0; background-color: #FFFFFF;\"> pdays </th>\n   <th style=\"text-align:center;position: sticky; top:0; background-color: #FFFFFF;\"> previous </th>\n   <th style=\"text-align:center;position: sticky; top:0; background-color: #FFFFFF;\"> poutcome </th>\n   <th style=\"text-align:center;position: sticky; top:0; background-color: #FFFFFF;\"> y </th>\n  </tr>\n </thead>\n<tbody>\n  <tr>\n   <td style=\"text-align:center;\"> 1 </td>\n   <td style=\"text-align:center;\"> 30 </td>\n   <td style=\"text-align:center;\"> unemployed </td>\n   <td style=\"text-align:center;\"> married </td>\n   <td style=\"text-align:center;\"> primary </td>\n   <td style=\"text-align:center;\"> no </td>\n   <td style=\"text-align:center;\"> 1787 </td>\n   <td style=\"text-align:center;\"> no </td>\n   <td style=\"text-align:center;\"> no </td>\n   <td style=\"text-align:center;\"> cellular </td>\n   <td style=\"text-align:center;\"> 19 </td>\n   <td style=\"text-align:center;\"> oct </td>\n   <td style=\"text-align:center;\"> 79 </td>\n   <td style=\"text-align:center;\"> 1 </td>\n   <td style=\"text-align:center;\"> -1 </td>\n   <td style=\"text-align:center;\"> 0 </td>\n   <td style=\"text-align:center;\"> unknown </td>\n   <td style=\"text-align:center;\"> no </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:center;\"> 2 </td>\n   <td style=\"text-align:center;\"> 33 </td>\n   <td style=\"text-align:center;\"> services </td>\n   <td style=\"text-align:center;\"> married </td>\n   <td style=\"text-align:center;\"> secondary </td>\n   <td style=\"text-align:center;\"> no </td>\n   <td style=\"text-align:center;\"> 4789 </td>\n   <td style=\"text-align:center;\"> yes </td>\n   <td style=\"text-align:center;\"> yes </td>\n   <td style=\"text-align:center;\"> cellular </td>\n   <td style=\"text-align:center;\"> 11 </td>\n   <td style=\"text-align:center;\"> may </td>\n   <td style=\"text-align:center;\"> 220 </td>\n   <td style=\"text-align:center;\"> 1 </td>\n   <td style=\"text-align:center;\"> 339 </td>\n   <td style=\"text-align:center;\"> 4 </td>\n   <td style=\"text-align:center;\"> failure </td>\n   <td style=\"text-align:center;\"> no </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:center;\"> 3 </td>\n   <td style=\"text-align:center;\"> 35 </td>\n   <td style=\"text-align:center;\"> management </td>\n   <td style=\"text-align:center;\"> single </td>\n   <td style=\"text-align:center;\"> tertiary </td>\n   <td style=\"text-align:center;\"> no </td>\n   <td style=\"text-align:center;\"> 1350 </td>\n   <td style=\"text-align:center;\"> yes </td>\n   <td style=\"text-align:center;\"> no </td>\n   <td style=\"text-align:center;\"> cellular </td>\n   <td style=\"text-align:center;\"> 16 </td>\n   <td style=\"text-align:center;\"> apr </td>\n   <td style=\"text-align:center;\"> 185 </td>\n   <td style=\"text-align:center;\"> 1 </td>\n   <td style=\"text-align:center;\"> 330 </td>\n   <td style=\"text-align:center;\"> 1 </td>\n   <td style=\"text-align:center;\"> failure </td>\n   <td style=\"text-align:center;\"> no </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:center;\"> 4 </td>\n   <td style=\"text-align:center;\"> 30 </td>\n   <td style=\"text-align:center;\"> management </td>\n   <td style=\"text-align:center;\"> married </td>\n   <td style=\"text-align:center;\"> tertiary </td>\n   <td style=\"text-align:center;\"> no </td>\n   <td style=\"text-align:center;\"> 1476 </td>\n   <td style=\"text-align:center;\"> yes </td>\n   <td style=\"text-align:center;\"> yes </td>\n   <td style=\"text-align:center;\"> unknown </td>\n   <td style=\"text-align:center;\"> 3 </td>\n   <td style=\"text-align:center;\"> jun </td>\n   <td style=\"text-align:center;\"> 199 </td>\n   <td style=\"text-align:center;\"> 4 </td>\n   <td style=\"text-align:center;\"> -1 </td>\n   <td style=\"text-align:center;\"> 0 </td>\n   <td style=\"text-align:center;\"> unknown </td>\n   <td style=\"text-align:center;\"> no </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:center;\"> 5 </td>\n   <td style=\"text-align:center;\"> 59 </td>\n   <td style=\"text-align:center;\"> blue-collar </td>\n   <td style=\"text-align:center;\"> married </td>\n   <td style=\"text-align:center;\"> secondary </td>\n   <td style=\"text-align:center;\"> no </td>\n   <td style=\"text-align:center;\"> 0 </td>\n   <td style=\"text-align:center;\"> yes </td>\n   <td style=\"text-align:center;\"> no </td>\n   <td style=\"text-align:center;\"> unknown </td>\n   <td style=\"text-align:center;\"> 5 </td>\n   <td style=\"text-align:center;\"> may </td>\n   <td style=\"text-align:center;\"> 226 </td>\n   <td style=\"text-align:center;\"> 1 </td>\n   <td style=\"text-align:center;\"> -1 </td>\n   <td style=\"text-align:center;\"> 0 </td>\n   <td style=\"text-align:center;\"> unknown </td>\n   <td style=\"text-align:center;\"> no </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:center;\"> 6 </td>\n   <td style=\"text-align:center;\"> 35 </td>\n   <td style=\"text-align:center;\"> management </td>\n   <td style=\"text-align:center;\"> single </td>\n   <td style=\"text-align:center;\"> tertiary </td>\n   <td style=\"text-align:center;\"> no </td>\n   <td style=\"text-align:center;\"> 747 </td>\n   <td style=\"text-align:center;\"> no </td>\n   <td style=\"text-align:center;\"> no </td>\n   <td style=\"text-align:center;\"> cellular </td>\n   <td style=\"text-align:center;\"> 23 </td>\n   <td style=\"text-align:center;\"> feb </td>\n   <td style=\"text-align:center;\"> 141 </td>\n   <td style=\"text-align:center;\"> 2 </td>\n   <td style=\"text-align:center;\"> 176 </td>\n   <td style=\"text-align:center;\"> 3 </td>\n   <td style=\"text-align:center;\"> failure </td>\n   <td style=\"text-align:center;\"> no </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:center;\"> 7 </td>\n   <td style=\"text-align:center;\"> 36 </td>\n   <td style=\"text-align:center;\"> self-employed </td>\n   <td style=\"text-align:center;\"> married </td>\n   <td style=\"text-align:center;\"> tertiary </td>\n   <td style=\"text-align:center;\"> no </td>\n   <td style=\"text-align:center;\"> 307 </td>\n   <td style=\"text-align:center;\"> yes </td>\n   <td style=\"text-align:center;\"> no </td>\n   <td style=\"text-align:center;\"> cellular </td>\n   <td style=\"text-align:center;\"> 14 </td>\n   <td style=\"text-align:center;\"> may </td>\n   <td style=\"text-align:center;\"> 341 </td>\n   <td style=\"text-align:center;\"> 1 </td>\n   <td style=\"text-align:center;\"> 330 </td>\n   <td style=\"text-align:center;\"> 2 </td>\n   <td style=\"text-align:center;\"> other </td>\n   <td style=\"text-align:center;\"> no </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:center;\"> 8 </td>\n   <td style=\"text-align:center;\"> 39 </td>\n   <td style=\"text-align:center;\"> technician </td>\n   <td style=\"text-align:center;\"> married </td>\n   <td style=\"text-align:center;\"> secondary </td>\n   <td style=\"text-align:center;\"> no </td>\n   <td style=\"text-align:center;\"> 147 </td>\n   <td style=\"text-align:center;\"> yes </td>\n   <td style=\"text-align:center;\"> no </td>\n   <td style=\"text-align:center;\"> cellular </td>\n   <td style=\"text-align:center;\"> 6 </td>\n   <td style=\"text-align:center;\"> may </td>\n   <td style=\"text-align:center;\"> 151 </td>\n   <td style=\"text-align:center;\"> 2 </td>\n   <td style=\"text-align:center;\"> -1 </td>\n   <td style=\"text-align:center;\"> 0 </td>\n   <td style=\"text-align:center;\"> unknown </td>\n   <td style=\"text-align:center;\"> no </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:center;\"> 9 </td>\n   <td style=\"text-align:center;\"> 41 </td>\n   <td style=\"text-align:center;\"> entrepreneur </td>\n   <td style=\"text-align:center;\"> married </td>\n   <td style=\"text-align:center;\"> tertiary </td>\n   <td style=\"text-align:center;\"> no </td>\n   <td style=\"text-align:center;\"> 221 </td>\n   <td style=\"text-align:center;\"> yes </td>\n   <td style=\"text-align:center;\"> no </td>\n   <td style=\"text-align:center;\"> unknown </td>\n   <td style=\"text-align:center;\"> 14 </td>\n   <td style=\"text-align:center;\"> may </td>\n   <td style=\"text-align:center;\"> 57 </td>\n   <td style=\"text-align:center;\"> 2 </td>\n   <td style=\"text-align:center;\"> -1 </td>\n   <td style=\"text-align:center;\"> 0 </td>\n   <td style=\"text-align:center;\"> unknown </td>\n   <td style=\"text-align:center;\"> no </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:center;\"> 10 </td>\n   <td style=\"text-align:center;\"> 43 </td>\n   <td style=\"text-align:center;\"> services </td>\n   <td style=\"text-align:center;\"> married </td>\n   <td style=\"text-align:center;\"> primary </td>\n   <td style=\"text-align:center;\"> no </td>\n   <td style=\"text-align:center;\"> -88 </td>\n   <td style=\"text-align:center;\"> yes </td>\n   <td style=\"text-align:center;\"> yes </td>\n   <td style=\"text-align:center;\"> cellular </td>\n   <td style=\"text-align:center;\"> 17 </td>\n   <td style=\"text-align:center;\"> apr </td>\n   <td style=\"text-align:center;\"> 313 </td>\n   <td style=\"text-align:center;\"> 1 </td>\n   <td style=\"text-align:center;\"> 147 </td>\n   <td style=\"text-align:center;\"> 2 </td>\n   <td style=\"text-align:center;\"> failure </td>\n   <td style=\"text-align:center;\"> no </td>\n  </tr>\n</tbody>\n</table></div>\n\n`````\n:::\n:::\n\n\n\n\n\n## Dataset structure\n\nBefore we do any analysis we have to define what kind of data we have available. We can assess this type of information by looking on the values of each variable. Generally, we can classify our variables, depending their values, as follows :\n\n<center>\n\n\n\n```{mermaid}\ngraph TD;\n  A(Type of variables) --> B(Quantitative)\n  A(Type of variables) --> C(Qualitative)\n  B --> D(Discrete)\n  B --> E(Continuous)\n  C --> J(Nominal)\n  C --> G(Ordinal)\n```\n\n\n\n</center>\n\nOur dataset is consisted by 18 variables (columns) and 4521 observations (rows). More specifically, concerning my variables, are as follows :\n\n| Variable    | Property                           | Description     |\n| :----:      |    :----:                          |    :----: |\n| `Age`       | *quantitative*  <br> (continuous)  | The age of the respondent  |\n| `Job`       | *qualitative*   <br> (nominal)     | The sector of employment of the respondent |\n| `Marital`   | *qualitative*   <br> (nominal)     | The marital status of the respondent      |\n| `Education` | *qualitative*   <br> (ordinal)     | The higher education level that the respondent has ever reached  |\n| `Default`   | *qualitative*   <br> (nominal)     | has credit in default? |\n| `Balance`   | *quantitative*  <br> (continuous)  | Average yearly balance, in euros |\n| `Housing`   | *qualitative*   <br> (nominal)     | Has housing loan? |\n| `Loan`      | *qualitative*   <br> (nominal)     | Has personal loan? |\n| `Contact`   | *qualitative*   <br> (nominal)     | Contact communication type |\n| `Month`     | *qualitative*    <br> (ordinal)    | Last contact day of the month|\n| `Duration`  | *quantitative*   <br> (continuous) | Last contact duration, in seconds (numeric)|\n| `Campaign`  | *quantitative* |  Number of contacts performed during this campaign and for this client |\n| `pdays`     | *quantitative*  | Number of days that passed by after the client was last contacted from a previous campaign |\n| `pprevious` | *quantitative*  |  Number of contacts performed before this campaign and for this client |\n| `poutcome`  | *qualitative*  (nominal)  | Outcome of the previous marketing campaign |\n| `Deposit`   | *qualitative*  <br> (nominal)  | Has the client subscribed a term deposit? |\n\nThus, my sample has 18 variables, of which 7 are quantitative and 10 are quantitative properties, of which 8 are nominal and the rest ones (`Education`, `Month`) are ordinal.\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nbank_dataset$y = as.factor(bank_dataset$y)\n```\n:::\n\n\n\n\n\n## Custom functions\n\n> So, I have a basic idea about my data. Can we start analyzing our data?\n\nIt depends. If you want to do a simple analysis then yes. Although most of the times this is not the case. Probably there is the need for repetitive actions. In order to not repeat ourselves we need to define some actions, prior to our analysis.\n\nOn this occasion, I found beneficial the definition of a function for qualitative data.\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nunivariate_qualitative = function(variable, title_plot){\ntable = bank_dataset %>%\n    select(variable) %>%\n    table() %>%\n    prop.table() %>%\n    as.data.frame() %>%\n    magrittr::set_colnames(c(\"Var1\", \"Freq\"))\n  \nplot =  ggplot(data = table, aes(x = fct_reorder(Var1,Freq, .desc = T), fill=Var1, y = Freq)) + \n     geom_bar(stat = \"identity\")+\n     scale_fill_hue(c = 40) +\n     geom_text(aes(label = sprintf(\"%.2f %%\", Freq*100),  stat=\"identity\",\n        vjust = -.1)) +\n     labs(\n       title = title_plot,\n       caption = \"Bank Marketing Dataset from <b>UCI</b>\",\n       x = \"Response\",\n       y = \"Observations\"\n        ) +\n     theme_classic() +\n     theme(legend.position = \"none\",\n        axis.text.x = element_text(angle = 30, vjust = 0.5),\n        plot.caption = element_markdown(lineheight = 1.2),\n        plot.title = element_text(hjust = 0.5),)\n  \nreturn(plot)\n}\n```\n:::\n\n\n\n\nI will do the same for univariate numeric data. \n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nuniv_quanti = function(variable_sel){\n  ggplot(bank_dataset, aes(x = variable_sel )) +\n  geom_histogram(x = variable_sel, stat = \"count\") +\n  scale_fill_hue(c = 40) +\n  labs(\n    title = \"Age Distribution of Respondents\",\n    caption = \"Bank Marketing Dataset from <b>UCI</b>\",\n    x = \"Age of Respondent\",\n    y = \"Observations\"\n  ) +\n  theme_classic() + \n  theme(\n    plot.caption = element_markdown(lineheight = 1.2),\n    plot.title = element_text(hjust = 0.5))\n}\n```\n:::\n\n\n\n\n\n# EDA with R\n\n## Missing Values\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nhow_many_nas = sum(is.na(bank_dataset))\n```\n:::\n\n\n\n\nOn this dataset there are 0 missing values, in total. So, there is no need for imputation.\n\n\n## Univariate analysis\n\n### Qualitative variables\n\n::: {.panel-tabset}\n\n#### Job\n\n\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nunivariate_qualitative(\"job\", \"Job of Respondent\")\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/Figure - Job-1.png){fig-align='center' width=672}\n:::\n:::\n\n\n\n\n\n####  Marital status\n\n\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nunivariate_qualitative(\"marital\", \"Marital Status of the respondent\")\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/Figure - Marital Status-1.png){fig-align='center' width=672}\n:::\n:::\n\n\n\n\n\n\n\n\n#### Education\n\n\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nunivariate_qualitative(\"education\", \"Educational Backgroung\")\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/Figure - Education-1.png){fig-align='center' width=672}\n:::\n:::\n\n\n\n\n#### Default\n\n\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nunivariate_qualitative(\"default\", \"Has credit in default ?\")\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/Figure - Default-1.png){fig-align='center' width=672}\n:::\n:::\n\n\n\n\n####  Housing \n\n\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nunivariate_qualitative(\"housing\", \"Has housing loan?\")\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/Figure - Housing-1.png){fig-align='center' width=672}\n:::\n:::\n\n\n\n\n\n#### Loan \n\n\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nunivariate_qualitative(\"loan\", \"Has personal loan ?\")\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/Figure - Loan-1.png){fig-align='center' width=672}\n:::\n:::\n\n\n\n\n\n#### Contact\n\n\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nunivariate_qualitative(\"contact\", \"Type of Contact\")\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/Figure - Contact -1.png){fig-align='center' width=672}\n:::\n:::\n\n\n\n\n\n#### Month\n\n\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\noptions(digits =2)\n\nperc_month = table(bank_dataset$month) %>%\n  prop.table() %>%\n  sort(decreasing = T) %>%\n  as.data.frame()\n\nnum_month = table(bank_dataset$month) %>%\n  sort(decreasing = T) %>%\n  as.data.frame()\n\nperc_month %>%\n    ggplot(aes(x = factor(Var1, level = c('jan', 'feb', 'mar', 'apr','may','jun','jul','aug','sep', 'oct', 'nov', 'dec')), y = Freq)) + \n  geom_bar(stat = \"identity\")+\n  scale_fill_hue(c = 40) +\n  geom_text(aes(label = sprintf(\"%.2f\", Freq*100),  stat=\"identity\",\n        vjust = -.25)) +\n  labs(\n    title = \"Calls per month\",\n    caption = \"Bank Marketing Dataset from <b>UCI</b>\",\n    x = \"Response\",\n    y = \"Observations\"\n  ) +\n  theme_classic() +\n  theme(legend.position = \"none\",\n        axis.text.x = element_text(vjust = 0.5),\n        plot.caption = element_markdown(lineheight = 1.2),\n        plot.title = element_text(hjust = 0.5))\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/Figure - Month -1.png){fig-align='center' width=672}\n:::\n:::\n\n\n\n\n\n#### poutcome\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nunivariate_qualitative(\"poutcome\", \"Outcome of previous approach\")\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/Figure - poutcome-1.png){width=672}\n:::\n:::\n\n\n\n\n#### Deposit \n\n\n\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nunivariate_qualitative(\"y\", \"How many people made a deposit account ?\")\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/Figure - Output Variable (Deposit Account (Y/N))-1.png){fig-align='center' width=672}\n:::\n:::\n\n\n\n\n:::\n\n### Quantitative variables\n\n::: {.panel-tabset}\n\n\n#### Age \n\n\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nggplot(bank_dataset, aes(x = age )) +\n  geom_bar() +\n  scale_fill_hue(c = 40) +\n  labs(\n    title = \"Age Distribution of Respondents\",\n    caption = \"Bank Marketing Dataset from <b>UCI</b>\",\n    x = \"Age of Respondent\",\n    y = \"Observations\"\n  ) +\n  theme_classic() + \n  theme(\n    plot.caption = element_markdown(lineheight = 1.2),\n    plot.title = element_text(hjust = 0.5))\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/Figure - Age-1.png){fig-align='center' width=672}\n:::\n\n```{.r .cell-code}\n# NOTE : In order to make HTML tags to work I need to specify element on theme command.\n```\n:::\n\n\n\n\n\n#### Balance\n\n\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nggplot(bank_dataset, aes(x=balance)) + \n  geom_histogram(bins = 20) +\n  scale_fill_hue(c = 40) +\n  labs(\n    title = \"Average yearly balance\",\n    caption = \" Bank Marketing Data Set from <b>UCI</b>\",\n    x = \"Response\",\n    y = \"Observations\"\n  ) +\n  theme_bw() +\n  theme(legend.position = \"none\",\n        plot.caption = element_markdown(lineheight = 1.2),\n        plot.title = element_text(hjust = 0.5))\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/Figure - Balance-1.png){fig-align='center' width=672}\n:::\n:::\n\n\n\n\n\n####  Duration\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot(bank_dataset, aes(x=duration, fill=duration)) + \n  geom_histogram( ) +\n  scale_fill_hue(c = 40) +\n  theme_bw() +\n  labs(\n    title = \"How many people made a deposit account ?\",\n    caption = \"Data from the 1974 Motor Trend US magazine.\",\n    x = \"Response\",\n    y = \"Observations\"\n  ) +\n  theme_classic() +\n  theme(legend.position = \"none\")\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\n`stat_bin()` using `bins = 30`. Pick better value with `binwidth`.\n```\n\n\n:::\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-7-1.png){width=672}\n:::\n:::\n\n\n\n\n\n####  Campaign\n\n\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nggplot(bank_dataset, aes(x= campaign, fill=campaign )) + \n  geom_bar() +\n  scale_fill_hue(c = 40) +\n  theme_bw() +\n  labs(\n    title = \"Number of Approaches to a specific person\",\n    x = \"# of Approaches\",\n    y = \"Observations\"\n  ) + \n  theme_classic()\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/Figure - Campaign - Num of Approaches to specific person-1.png){fig-align='center' width=672}\n:::\n:::\n\n\n\n\n:::\n\n\n\n## Bivariate analysis\n\nOn the previous section I learned a lot about my dataset. Now, I have to reveal relationships between my variables. Visualizing those relationships will make it even easier to explain our results. In order to make the right plots on the right occasions I used the book \"Datavis with R\" ([Chapter 4 : Bivariate Graphs](https://rkabacoff.github.io/datavis/Bivariate.html)). \n\n\n### Qualitative variables\n\n::: {.panel-tabset}\n\n#### Job\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nplotjob <- bank_dataset %>%\n  group_by(job, y) %>%\n  summarize(n = n()) %>% \n  mutate(pct = n/sum(n),\n         lbl = scales::percent(pct))\n\nplot_job = ggplot(plotjob, \n       aes(x = fct_reorder(job, pct),\n           y = pct,\n           fill = y)) + \n  geom_bar(stat = \"identity\",\n           position = \"fill\") +\n  geom_text(aes(label = lbl), \n            size = 3, \n            position = position_stack(vjust = 0.5)) +\n  scale_fill_brewer(palette = \"Set2\") +\n  labs(y = \"Percent\", \n       fill = \"Drive Train\",\n       x = \"Class\",\n       title = \"Job of Respondent by Interest to Term Deposit\") +\n  theme_classic() +\n  theme(legend.position = \"none\",\n        axis.text.x = element_text(angle = 30, vjust = 0.5),\n        plot.caption = element_markdown(lineheight = 1.2),\n        plot.title = element_text(hjust = 0.5))\n\nplot_job\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-8-1.png){width=672}\n:::\n:::\n\n\n\n\n#### Marital status\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nplot_marital1 <- ggplot(bank_dataset, \n       aes(x = marital, \n           fill = y)) + \n       scale_fill_hue(c = 40) +\n       theme_bw() +\n       geom_bar(position = position_dodge(preserve = \"single\"))\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nplotmarital <- bank_dataset %>%\n  group_by(marital, y) %>%\n  summarize(n = n()) %>% \n  mutate(pct = n/sum(n),\n         lbl = scales::percent(pct))\n\nplot_marital2 = ggplot(plotmarital, \n       aes(x = marital,\n           y = pct,\n           fill = y)) + \n  geom_bar(stat = \"identity\",\n           position = \"fill\") +\n  geom_text(aes(label = lbl), \n            size = 3, \n            position = position_stack(vjust = 0.5)) +\n  scale_fill_brewer(palette = \"Set2\") +\n  labs(y = \"Percent\", \n       fill = \"Drive Train\",\n       x = \"Class\",\n       title = \"Marital Status by Interest to Term Deposit\") +\n  theme_classic() +\n  theme(legend.position = \"none\",\n        axis.text.x = element_text(angle = 30, vjust = 0.5),\n        plot.caption = element_markdown(lineheight = 1.2),\n        plot.title = element_text(hjust = 0.5))\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\ngridExtra::grid.arrange(plot_marital1, plot_marital2, nrow =1)\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-11-1.png){width=672}\n:::\n:::\n\n\n\n\n\n#### Education\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nplot_education1 <- ggplot(bank_dataset, \n       aes(x = education, \n           fill = y)) + \n       scale_fill_hue(c = 40) +\n       theme_bw() +\n       geom_bar(position = position_dodge(preserve = \"single\"))\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nplot_education2 = bank_dataset %>%\n  group_by(education, y) %>%\n  summarize(n = n()) %>% \n  mutate(pct = n/sum(n),\n         lbl = scales::percent(pct)) %>%\n    ggplot(aes(x = education,\n           y = pct,\n           fill = y)) + \n  geom_bar(stat = \"identity\",\n           position = \"fill\") +\n  geom_text(aes(label = lbl), \n            size = 3, \n            position = position_stack(vjust = 0.5)) +\n  scale_fill_brewer(palette = \"Set2\") +\n  labs(y = \"Percent\", \n       fill = \"Drive Train\",\n       x = \"Class\",\n       title = \"Educational Background by Interest to Term Deposit\") +\n  theme_classic() +\n  theme(legend.position = \"none\",\n        axis.text.x = element_text(angle = 30, vjust = 0.5),\n        plot.caption = element_markdown(lineheight = 1.2),\n        plot.title = element_text(hjust = 0.5))\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\ngridExtra::grid.arrange(plot_education1, plot_education2, nrow =1)\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-14-1.png){width=672}\n:::\n:::\n\n\n\n\n\n#### Default\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nplot_default1 <- ggplot(bank_dataset, \n       aes(x = default, \n           fill = y)) + \n        scale_fill_hue(c = 40) +\n        theme_bw() +\n  geom_bar(position = position_dodge(preserve = \"single\"))\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nplot_default2 = bank_dataset %>%\n  group_by(default, y) %>%\n  summarize(n = n()) %>% \n  mutate(pct = n/sum(n),\n         lbl = scales::percent(pct)) %>%\n    ggplot(aes(x = default,\n           y = pct,\n           fill = y)) + \n  geom_bar(stat = \"identity\",\n           position = \"fill\") +\n  geom_text(aes(label = lbl), \n            size = 3, \n            position = position_stack(vjust = 0.5)) +\n  scale_fill_brewer(palette = \"Set2\") +\n  labs(y = \"Percent\", \n       fill = \"Drive Train\",\n       x = \"Class\",\n       title = \"Has credit in default ?\") +\n  theme_classic() +\n  theme(legend.position = \"none\",\n        axis.text.x = element_text(angle = 30, vjust = 0.5),\n        plot.caption = element_markdown(lineheight = 1.2),\n        plot.title = element_text(hjust = 0.5))\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\n`summarise()` has grouped output by 'default'. You can override using the\n`.groups` argument.\n```\n\n\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\ngridExtra::grid.arrange(plot_default1, plot_default2, nrow =1)\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-17-1.png){width=672}\n:::\n:::\n\n\n\n\n#### Housing\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nplot_housing1 <- ggplot(bank_dataset, \n       aes(x = housing, \n           fill = y)) + \n       scale_fill_hue(c = 40) +\n       theme_bw() +\n  geom_bar(position = position_dodge(preserve = \"single\"))\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nplot_housing2 = bank_dataset %>%\n  group_by(housing, y) %>%\n  summarize(n = n()) %>% \n  mutate(pct = n/sum(n),\n         lbl = scales::percent(pct)) %>%\n    ggplot(aes(x = housing,\n           y = pct,\n           fill = y)) + \n  geom_bar(stat = \"identity\",\n           position = \"fill\") +\n  geom_text(aes(label = lbl), \n            size = 3, \n            position = position_stack(vjust = 0.5)) +\n  scale_fill_brewer(palette = \"Set2\") +\n  labs(y = \"Percent\", \n       fill = \"Drive Train\",\n       x = \"Class\",\n       title = \"Has housing loan ?\") +\n  theme_classic() +\n  theme(legend.position = \"none\",\n        axis.text.x = element_text(angle = 30, vjust = 0.5),\n        plot.caption = element_markdown(lineheight = 1.2),\n        plot.title = element_text(hjust = 0.5))\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\n`summarise()` has grouped output by 'housing'. You can override using the\n`.groups` argument.\n```\n\n\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\ngridExtra::grid.arrange(plot_housing1, plot_housing2, nrow =1)\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-20-1.png){width=672}\n:::\n:::\n\n\n\n\n\n\n\n#### Loan\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nplot_loan1 <- ggplot(bank_dataset, \n       aes(x = loan, \n           fill = y)) + \n      scale_fill_hue(c = 40) +\n      theme_bw() +\n      geom_bar(position = position_dodge(preserve = \"single\"))\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nplot_loan2 = bank_dataset %>%\n  group_by(loan, y) %>%\n  summarize(n = n()) %>% \n  mutate(pct = n/sum(n),\n         lbl = scales::percent(pct)) %>%\n    ggplot(aes(x = loan,\n           y = pct,\n           fill = y)) + \n  geom_bar(stat = \"identity\",\n           position = \"fill\") +\n  geom_text(aes(label = lbl), \n            size = 3, \n            position = position_stack(vjust = 0.5)) +\n  scale_fill_brewer(palette = \"Set2\") +\n  labs(y = \"Percent\", \n       fill = \"Interested\",\n       x = \"Class\",\n       title = \"Has personal loan ?\") +\n  theme_classic() +\n  theme(legend.position = \"none\",\n        axis.text.x = element_text(angle = 30, vjust = 0.5),\n        plot.caption = element_markdown(lineheight = 1.2),\n        plot.title = element_text(hjust = 0.5))\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\n`summarise()` has grouped output by 'loan'. You can override using the\n`.groups` argument.\n```\n\n\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\ngridExtra::grid.arrange(plot_loan1, plot_loan2, nrow =1)\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-23-1.png){width=672}\n:::\n:::\n\n\n\n\n#### Contact\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nplot_contact1 <- ggplot(bank_dataset, \n       aes(x = contact, \n           fill = y)) + \n        scale_fill_hue(c = 40) +\n        theme_bw() +\n  geom_bar(position = position_dodge(preserve = \"single\"))\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nplot_contact2 = bank_dataset %>%\n  group_by(contact, y) %>%\n  summarize(n = n()) %>% \n  mutate(pct = n/sum(n),\n         lbl = scales::percent(pct)) %>%\n    ggplot(aes(x = contact,\n           y = pct,\n           fill = y)) + \n  geom_bar(stat = \"identity\",\n           position = \"fill\") +\n  geom_text(aes(label = lbl), \n            size = 3, \n            position = position_stack(vjust = 0.5)) +\n  scale_fill_brewer(palette = \"Set2\") +\n  labs(y = \"Percent\", \n       fill = \"Interested\",\n       x = \"Class\",\n       title = \"Forms of contact\") +\n  theme_classic() +\n  theme(legend.position = \"none\",\n        axis.text.x = element_text(angle = 30, vjust = 0.5),\n        plot.caption = element_markdown(lineheight = 1.2),\n        plot.title = element_text(hjust = 0.5))\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\n`summarise()` has grouped output by 'contact'. You can override using the\n`.groups` argument.\n```\n\n\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\ngridExtra::grid.arrange(plot_contact1, plot_contact2, nrow =1)\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-26-1.png){width=672}\n:::\n:::\n\n\n\n\n\n#### Month\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nplot_month1 <- ggplot(bank_dataset, \n       aes(x = factor(month, level = c('jan', 'feb', 'mar', 'apr','may','jun','jul','aug','sep', 'oct', 'nov', 'dec')), \n           fill = y)) + \n       scale_fill_hue(c = 40) +\n       theme_bw() +\n  geom_bar(position = position_dodge(preserve = \"single\"))\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nplot_month2 <- ggplot(bank_dataset, \n       aes(x = factor(month, level = c('jan', 'feb', 'mar', 'apr','may','jun','jul','aug','sep', 'oct', 'nov', 'dec')), fill = y)) + \n       geom_bar(position = \"fill\") +\n  scale_fill_brewer(palette = \"Set2\") +\n  theme_minimal()\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\ngridExtra::grid.arrange(plot_month1, plot_month2, nrow =1)\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-29-1.png){width=672}\n:::\n:::\n\n\n\n\n#### poutcome\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nplot_poutcome1 <- ggplot(bank_dataset, \n       aes(x = poutcome, \n           fill = y)) + \n       scale_fill_hue(c = 40) +\n       theme_bw() +\n  geom_bar(position = position_dodge(preserve = \"single\"))\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nplot_poutcome2 = bank_dataset %>%\n  group_by(poutcome, y) %>%\n  summarize(n = n()) %>% \n  mutate(pct = n/sum(n),\n         lbl = scales::percent(pct)) %>%\n   ggplot(aes(x = poutcome,\n           y = pct,\n           fill = y)) + \n  geom_bar(stat = \"identity\",\n           position = \"fill\") +\n  geom_text(aes(label = lbl), \n            size = 3, \n            position = position_stack(vjust = 0.5)) +\n  scale_fill_brewer(palette = \"Set2\") +\n  labs(y = \"Percent\", \n       fill = \"Interested\",\n       x = \"Class\",\n       title = \"Previous Campaign outcome\") +\n  theme_classic() +\n  theme(legend.position = \"none\",\n        axis.text.x = element_text(angle = 30, vjust = 0.5),\n        plot.caption = element_markdown(lineheight = 1.2),\n        plot.title = element_text(hjust = 0.5))\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\ngridExtra::grid.arrange(plot_poutcome1, plot_poutcome2, nrow =1)\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-32-1.png){width=672}\n:::\n:::\n\n\n\n\n:::\n\n\n### Quantitative variables\n\n::: {.panel-tabset}\n\n#### Age \n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nbank_dataset %>%\nggplot(aes(x=y, y=age, fill=y)) +\n  geom_boxplot() +\n  scale_fill_hue(c = 40) +\n  theme_classic() +\n  labs(\n     title = \"Age & Desire of Bank Deposit Account\" \n  )\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-33-1.png){width=672}\n:::\n:::\n\n\n\n\n#### Balance\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nplot1 = bank_dataset[bank_dataset$balance < 15000, ] %>%\nggplot(aes(x = balance, \n           fill = y)) + \n        scale_fill_hue(c = 40) +\n        theme_bw() +\n  geom_histogram(bins=15)\n\nplot1\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-34-1.png){width=672}\n:::\n:::\n\n\n\n\n\n#### Duration\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot(bank_dataset, \n       aes(x = duration, \n           fill = y)) + \n       scale_fill_hue(c = 40) +\n       theme_bw() +\n  geom_histogram()\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\n`stat_bin()` using `bins = 30`. Pick better value with `binwidth`.\n```\n\n\n:::\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-35-1.png){width=672}\n:::\n:::\n\n\n\n\n\n#### Campaign\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot(bank_dataset, \n       aes(x = campaign, \n           fill = y)) + \n       scale_fill_hue(c = 40) +\n       theme_bw() +\n  geom_histogram()\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\n`stat_bin()` using `bins = 30`. Pick better value with `binwidth`.\n```\n\n\n:::\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-36-1.png){width=672}\n:::\n:::\n\n\n\n:::\n\n# Building model\n\nIn R there are two fairly well-known libraries when it comes to model generation, [caret](https://topepo.github.io/caret/) and [tidymodels](https://www.tidymodels.org/). On one hand, caret is pretty simple to use, has lots of sources, guides, explanatory articles. On the other hand, tidymodels is an all-in-one solution but has less documentation, articles compared to caret.\n\n\n## Split train/test dataset\n\n\nOur first step is to split our dataset on 2 parts. Each of those will be used for a different purpose. The first part's (train dataset) purpose is to build our model. The other part (test dataset) will be used to evaluate our model's performance. \n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nset.seed(123)\nbank_dataset_split <- initial_split(bank_dataset,\n                                prop = 0.75,\n                                strata = y)\n\n# Create training data\nbank_train <- bank_dataset_split %>%\n                    training()\n\n# Create testing data\nbank_test <- bank_dataset_split %>%\n                    testing()\n```\n:::\n\n\n\n\n\n\n::: {.panel-tabset}\n\n### Train dataset\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nhead(bank_train) %>%\n  kbl(toprule = T,align = 'c',booktabs = T)  %>%\n  kable_styling(full_width = F, position = \"center\", html_font = \"Cambria\") \n```\n\n::: {.cell-output-display}\n`````{=html}\n<table class=\"table\" style=\"font-family: Cambria; width: auto !important; margin-left: auto; margin-right: auto;\">\n <thead>\n  <tr>\n   <th style=\"text-align:center;\"> ID </th>\n   <th style=\"text-align:center;\"> age </th>\n   <th style=\"text-align:center;\"> job </th>\n   <th style=\"text-align:center;\"> marital </th>\n   <th style=\"text-align:center;\"> education </th>\n   <th style=\"text-align:center;\"> default </th>\n   <th style=\"text-align:center;\"> balance </th>\n   <th style=\"text-align:center;\"> housing </th>\n   <th style=\"text-align:center;\"> loan </th>\n   <th style=\"text-align:center;\"> contact </th>\n   <th style=\"text-align:center;\"> day </th>\n   <th style=\"text-align:center;\"> month </th>\n   <th style=\"text-align:center;\"> duration </th>\n   <th style=\"text-align:center;\"> campaign </th>\n   <th style=\"text-align:center;\"> pdays </th>\n   <th style=\"text-align:center;\"> previous </th>\n   <th style=\"text-align:center;\"> poutcome </th>\n   <th style=\"text-align:center;\"> y </th>\n  </tr>\n </thead>\n<tbody>\n  <tr>\n   <td style=\"text-align:center;\"> 1 </td>\n   <td style=\"text-align:center;\"> 30 </td>\n   <td style=\"text-align:center;\"> unemployed </td>\n   <td style=\"text-align:center;\"> married </td>\n   <td style=\"text-align:center;\"> primary </td>\n   <td style=\"text-align:center;\"> no </td>\n   <td style=\"text-align:center;\"> 1787 </td>\n   <td style=\"text-align:center;\"> no </td>\n   <td style=\"text-align:center;\"> no </td>\n   <td style=\"text-align:center;\"> cellular </td>\n   <td style=\"text-align:center;\"> 19 </td>\n   <td style=\"text-align:center;\"> oct </td>\n   <td style=\"text-align:center;\"> 79 </td>\n   <td style=\"text-align:center;\"> 1 </td>\n   <td style=\"text-align:center;\"> -1 </td>\n   <td style=\"text-align:center;\"> 0 </td>\n   <td style=\"text-align:center;\"> unknown </td>\n   <td style=\"text-align:center;\"> no </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:center;\"> 2 </td>\n   <td style=\"text-align:center;\"> 33 </td>\n   <td style=\"text-align:center;\"> services </td>\n   <td style=\"text-align:center;\"> married </td>\n   <td style=\"text-align:center;\"> secondary </td>\n   <td style=\"text-align:center;\"> no </td>\n   <td style=\"text-align:center;\"> 4789 </td>\n   <td style=\"text-align:center;\"> yes </td>\n   <td style=\"text-align:center;\"> yes </td>\n   <td style=\"text-align:center;\"> cellular </td>\n   <td style=\"text-align:center;\"> 11 </td>\n   <td style=\"text-align:center;\"> may </td>\n   <td style=\"text-align:center;\"> 220 </td>\n   <td style=\"text-align:center;\"> 1 </td>\n   <td style=\"text-align:center;\"> 339 </td>\n   <td style=\"text-align:center;\"> 4 </td>\n   <td style=\"text-align:center;\"> failure </td>\n   <td style=\"text-align:center;\"> no </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:center;\"> 4 </td>\n   <td style=\"text-align:center;\"> 30 </td>\n   <td style=\"text-align:center;\"> management </td>\n   <td style=\"text-align:center;\"> married </td>\n   <td style=\"text-align:center;\"> tertiary </td>\n   <td style=\"text-align:center;\"> no </td>\n   <td style=\"text-align:center;\"> 1476 </td>\n   <td style=\"text-align:center;\"> yes </td>\n   <td style=\"text-align:center;\"> yes </td>\n   <td style=\"text-align:center;\"> unknown </td>\n   <td style=\"text-align:center;\"> 3 </td>\n   <td style=\"text-align:center;\"> jun </td>\n   <td style=\"text-align:center;\"> 199 </td>\n   <td style=\"text-align:center;\"> 4 </td>\n   <td style=\"text-align:center;\"> -1 </td>\n   <td style=\"text-align:center;\"> 0 </td>\n   <td style=\"text-align:center;\"> unknown </td>\n   <td style=\"text-align:center;\"> no </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:center;\"> 5 </td>\n   <td style=\"text-align:center;\"> 59 </td>\n   <td style=\"text-align:center;\"> blue-collar </td>\n   <td style=\"text-align:center;\"> married </td>\n   <td style=\"text-align:center;\"> secondary </td>\n   <td style=\"text-align:center;\"> no </td>\n   <td style=\"text-align:center;\"> 0 </td>\n   <td style=\"text-align:center;\"> yes </td>\n   <td style=\"text-align:center;\"> no </td>\n   <td style=\"text-align:center;\"> unknown </td>\n   <td style=\"text-align:center;\"> 5 </td>\n   <td style=\"text-align:center;\"> may </td>\n   <td style=\"text-align:center;\"> 226 </td>\n   <td style=\"text-align:center;\"> 1 </td>\n   <td style=\"text-align:center;\"> -1 </td>\n   <td style=\"text-align:center;\"> 0 </td>\n   <td style=\"text-align:center;\"> unknown </td>\n   <td style=\"text-align:center;\"> no </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:center;\"> 7 </td>\n   <td style=\"text-align:center;\"> 36 </td>\n   <td style=\"text-align:center;\"> self-employed </td>\n   <td style=\"text-align:center;\"> married </td>\n   <td style=\"text-align:center;\"> tertiary </td>\n   <td style=\"text-align:center;\"> no </td>\n   <td style=\"text-align:center;\"> 307 </td>\n   <td style=\"text-align:center;\"> yes </td>\n   <td style=\"text-align:center;\"> no </td>\n   <td style=\"text-align:center;\"> cellular </td>\n   <td style=\"text-align:center;\"> 14 </td>\n   <td style=\"text-align:center;\"> may </td>\n   <td style=\"text-align:center;\"> 341 </td>\n   <td style=\"text-align:center;\"> 1 </td>\n   <td style=\"text-align:center;\"> 330 </td>\n   <td style=\"text-align:center;\"> 2 </td>\n   <td style=\"text-align:center;\"> other </td>\n   <td style=\"text-align:center;\"> no </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:center;\"> 8 </td>\n   <td style=\"text-align:center;\"> 39 </td>\n   <td style=\"text-align:center;\"> technician </td>\n   <td style=\"text-align:center;\"> married </td>\n   <td style=\"text-align:center;\"> secondary </td>\n   <td style=\"text-align:center;\"> no </td>\n   <td style=\"text-align:center;\"> 147 </td>\n   <td style=\"text-align:center;\"> yes </td>\n   <td style=\"text-align:center;\"> no </td>\n   <td style=\"text-align:center;\"> cellular </td>\n   <td style=\"text-align:center;\"> 6 </td>\n   <td style=\"text-align:center;\"> may </td>\n   <td style=\"text-align:center;\"> 151 </td>\n   <td style=\"text-align:center;\"> 2 </td>\n   <td style=\"text-align:center;\"> -1 </td>\n   <td style=\"text-align:center;\"> 0 </td>\n   <td style=\"text-align:center;\"> unknown </td>\n   <td style=\"text-align:center;\"> no </td>\n  </tr>\n</tbody>\n</table>\n\n`````\n:::\n:::\n\n\n\n\n\n### Test dataset\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nhead(bank_test) %>%\n  kbl(toprule = T,align = 'c',booktabs = T)  %>%\n  kable_styling(full_width = F, position = \"center\", html_font = \"Cambria\") \n```\n\n::: {.cell-output-display}\n`````{=html}\n<table class=\"table\" style=\"font-family: Cambria; width: auto !important; margin-left: auto; margin-right: auto;\">\n <thead>\n  <tr>\n   <th style=\"text-align:center;\"> ID </th>\n   <th style=\"text-align:center;\"> age </th>\n   <th style=\"text-align:center;\"> job </th>\n   <th style=\"text-align:center;\"> marital </th>\n   <th style=\"text-align:center;\"> education </th>\n   <th style=\"text-align:center;\"> default </th>\n   <th style=\"text-align:center;\"> balance </th>\n   <th style=\"text-align:center;\"> housing </th>\n   <th style=\"text-align:center;\"> loan </th>\n   <th style=\"text-align:center;\"> contact </th>\n   <th style=\"text-align:center;\"> day </th>\n   <th style=\"text-align:center;\"> month </th>\n   <th style=\"text-align:center;\"> duration </th>\n   <th style=\"text-align:center;\"> campaign </th>\n   <th style=\"text-align:center;\"> pdays </th>\n   <th style=\"text-align:center;\"> previous </th>\n   <th style=\"text-align:center;\"> poutcome </th>\n   <th style=\"text-align:center;\"> y </th>\n  </tr>\n </thead>\n<tbody>\n  <tr>\n   <td style=\"text-align:center;\"> 3 </td>\n   <td style=\"text-align:center;\"> 35 </td>\n   <td style=\"text-align:center;\"> management </td>\n   <td style=\"text-align:center;\"> single </td>\n   <td style=\"text-align:center;\"> tertiary </td>\n   <td style=\"text-align:center;\"> no </td>\n   <td style=\"text-align:center;\"> 1350 </td>\n   <td style=\"text-align:center;\"> yes </td>\n   <td style=\"text-align:center;\"> no </td>\n   <td style=\"text-align:center;\"> cellular </td>\n   <td style=\"text-align:center;\"> 16 </td>\n   <td style=\"text-align:center;\"> apr </td>\n   <td style=\"text-align:center;\"> 185 </td>\n   <td style=\"text-align:center;\"> 1 </td>\n   <td style=\"text-align:center;\"> 330 </td>\n   <td style=\"text-align:center;\"> 1 </td>\n   <td style=\"text-align:center;\"> failure </td>\n   <td style=\"text-align:center;\"> no </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:center;\"> 6 </td>\n   <td style=\"text-align:center;\"> 35 </td>\n   <td style=\"text-align:center;\"> management </td>\n   <td style=\"text-align:center;\"> single </td>\n   <td style=\"text-align:center;\"> tertiary </td>\n   <td style=\"text-align:center;\"> no </td>\n   <td style=\"text-align:center;\"> 747 </td>\n   <td style=\"text-align:center;\"> no </td>\n   <td style=\"text-align:center;\"> no </td>\n   <td style=\"text-align:center;\"> cellular </td>\n   <td style=\"text-align:center;\"> 23 </td>\n   <td style=\"text-align:center;\"> feb </td>\n   <td style=\"text-align:center;\"> 141 </td>\n   <td style=\"text-align:center;\"> 2 </td>\n   <td style=\"text-align:center;\"> 176 </td>\n   <td style=\"text-align:center;\"> 3 </td>\n   <td style=\"text-align:center;\"> failure </td>\n   <td style=\"text-align:center;\"> no </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:center;\"> 15 </td>\n   <td style=\"text-align:center;\"> 31 </td>\n   <td style=\"text-align:center;\"> blue-collar </td>\n   <td style=\"text-align:center;\"> married </td>\n   <td style=\"text-align:center;\"> secondary </td>\n   <td style=\"text-align:center;\"> no </td>\n   <td style=\"text-align:center;\"> 360 </td>\n   <td style=\"text-align:center;\"> yes </td>\n   <td style=\"text-align:center;\"> yes </td>\n   <td style=\"text-align:center;\"> cellular </td>\n   <td style=\"text-align:center;\"> 29 </td>\n   <td style=\"text-align:center;\"> jan </td>\n   <td style=\"text-align:center;\"> 89 </td>\n   <td style=\"text-align:center;\"> 1 </td>\n   <td style=\"text-align:center;\"> 241 </td>\n   <td style=\"text-align:center;\"> 1 </td>\n   <td style=\"text-align:center;\"> failure </td>\n   <td style=\"text-align:center;\"> no </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:center;\"> 23 </td>\n   <td style=\"text-align:center;\"> 44 </td>\n   <td style=\"text-align:center;\"> services </td>\n   <td style=\"text-align:center;\"> single </td>\n   <td style=\"text-align:center;\"> secondary </td>\n   <td style=\"text-align:center;\"> no </td>\n   <td style=\"text-align:center;\"> 106 </td>\n   <td style=\"text-align:center;\"> no </td>\n   <td style=\"text-align:center;\"> no </td>\n   <td style=\"text-align:center;\"> unknown </td>\n   <td style=\"text-align:center;\"> 12 </td>\n   <td style=\"text-align:center;\"> jun </td>\n   <td style=\"text-align:center;\"> 109 </td>\n   <td style=\"text-align:center;\"> 2 </td>\n   <td style=\"text-align:center;\"> -1 </td>\n   <td style=\"text-align:center;\"> 0 </td>\n   <td style=\"text-align:center;\"> unknown </td>\n   <td style=\"text-align:center;\"> no </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:center;\"> 51 </td>\n   <td style=\"text-align:center;\"> 45 </td>\n   <td style=\"text-align:center;\"> blue-collar </td>\n   <td style=\"text-align:center;\"> divorced </td>\n   <td style=\"text-align:center;\"> primary </td>\n   <td style=\"text-align:center;\"> no </td>\n   <td style=\"text-align:center;\"> 844 </td>\n   <td style=\"text-align:center;\"> no </td>\n   <td style=\"text-align:center;\"> no </td>\n   <td style=\"text-align:center;\"> unknown </td>\n   <td style=\"text-align:center;\"> 5 </td>\n   <td style=\"text-align:center;\"> jun </td>\n   <td style=\"text-align:center;\"> 1018 </td>\n   <td style=\"text-align:center;\"> 3 </td>\n   <td style=\"text-align:center;\"> -1 </td>\n   <td style=\"text-align:center;\"> 0 </td>\n   <td style=\"text-align:center;\"> unknown </td>\n   <td style=\"text-align:center;\"> yes </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:center;\"> 52 </td>\n   <td style=\"text-align:center;\"> 37 </td>\n   <td style=\"text-align:center;\"> technician </td>\n   <td style=\"text-align:center;\"> single </td>\n   <td style=\"text-align:center;\"> secondary </td>\n   <td style=\"text-align:center;\"> no </td>\n   <td style=\"text-align:center;\"> 228 </td>\n   <td style=\"text-align:center;\"> yes </td>\n   <td style=\"text-align:center;\"> no </td>\n   <td style=\"text-align:center;\"> cellular </td>\n   <td style=\"text-align:center;\"> 20 </td>\n   <td style=\"text-align:center;\"> aug </td>\n   <td style=\"text-align:center;\"> 1740 </td>\n   <td style=\"text-align:center;\"> 2 </td>\n   <td style=\"text-align:center;\"> -1 </td>\n   <td style=\"text-align:center;\"> 0 </td>\n   <td style=\"text-align:center;\"> unknown </td>\n   <td style=\"text-align:center;\"> no </td>\n  </tr>\n</tbody>\n</table>\n\n`````\n:::\n:::\n\n\n\n\n:::\n\n## Recipes\n\nAn important part in the process of model building is preprocessing.\nDepending of model type and data structure, I have to do the necessary changes. The *tidymodels* offers some ready-made preprocessing functions which make the whole process piece of cake.\n\n\nIn instance, the dataset I am working right now has imbalanced response variable (term deposit interest). For that reason, I used the recipe `step_smote()` from *themis* package. \n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nbank_recipe <- recipes::recipe(y~., \n                               data = bank_train) %>%\n  step_rm(poutcome, ID) %>%\n  step_corr(all_numeric(), threshold = 0.75) %>%\n  step_dummy(all_nominal(), -all_outcomes()) %>% prep() %>%\n  step_smote(y) %>%\n  prep()\n```\n:::\n\n\n\n\nLet's preview our dataset after applying our recipes :\n\n\n\n\n::: {#tbl-recipes-df .cell tbl-cap='Dataset after `recipes`'}\n\n```{.r .cell-code}\nbank_recipe %>%\n  prep() %>%\n  juice() %>%\n  head() %>%\n  kbl() %>%\n  kable_styling(full_width = F, position = \"center\", html_font = \"Cambria\") \n```\n\n::: {.cell-output-display}\n`````{=html}\n<table class=\"table\" style=\"font-family: Cambria; width: auto !important; margin-left: auto; margin-right: auto;\">\n <thead>\n  <tr>\n   <th style=\"text-align:right;\"> age </th>\n   <th style=\"text-align:right;\"> balance </th>\n   <th style=\"text-align:right;\"> day </th>\n   <th style=\"text-align:right;\"> duration </th>\n   <th style=\"text-align:right;\"> campaign </th>\n   <th style=\"text-align:right;\"> pdays </th>\n   <th style=\"text-align:right;\"> previous </th>\n   <th style=\"text-align:right;\"> job_blue.collar </th>\n   <th style=\"text-align:right;\"> job_entrepreneur </th>\n   <th style=\"text-align:right;\"> job_housemaid </th>\n   <th style=\"text-align:right;\"> job_management </th>\n   <th style=\"text-align:right;\"> job_retired </th>\n   <th style=\"text-align:right;\"> job_self.employed </th>\n   <th style=\"text-align:right;\"> job_services </th>\n   <th style=\"text-align:right;\"> job_student </th>\n   <th style=\"text-align:right;\"> job_technician </th>\n   <th style=\"text-align:right;\"> job_unemployed </th>\n   <th style=\"text-align:right;\"> job_unknown </th>\n   <th style=\"text-align:right;\"> marital_married </th>\n   <th style=\"text-align:right;\"> marital_single </th>\n   <th style=\"text-align:right;\"> education_secondary </th>\n   <th style=\"text-align:right;\"> education_tertiary </th>\n   <th style=\"text-align:right;\"> education_unknown </th>\n   <th style=\"text-align:right;\"> default_yes </th>\n   <th style=\"text-align:right;\"> housing_yes </th>\n   <th style=\"text-align:right;\"> loan_yes </th>\n   <th style=\"text-align:right;\"> contact_telephone </th>\n   <th style=\"text-align:right;\"> contact_unknown </th>\n   <th style=\"text-align:right;\"> month_aug </th>\n   <th style=\"text-align:right;\"> month_dec </th>\n   <th style=\"text-align:right;\"> month_feb </th>\n   <th style=\"text-align:right;\"> month_jan </th>\n   <th style=\"text-align:right;\"> month_jul </th>\n   <th style=\"text-align:right;\"> month_jun </th>\n   <th style=\"text-align:right;\"> month_mar </th>\n   <th style=\"text-align:right;\"> month_may </th>\n   <th style=\"text-align:right;\"> month_nov </th>\n   <th style=\"text-align:right;\"> month_oct </th>\n   <th style=\"text-align:right;\"> month_sep </th>\n   <th style=\"text-align:left;\"> y </th>\n  </tr>\n </thead>\n<tbody>\n  <tr>\n   <td style=\"text-align:right;\"> 30 </td>\n   <td style=\"text-align:right;\"> 1787 </td>\n   <td style=\"text-align:right;\"> 19 </td>\n   <td style=\"text-align:right;\"> 79 </td>\n   <td style=\"text-align:right;\"> 1 </td>\n   <td style=\"text-align:right;\"> -1 </td>\n   <td style=\"text-align:right;\"> 0 </td>\n   <td style=\"text-align:right;\"> 0 </td>\n   <td style=\"text-align:right;\"> 0 </td>\n   <td style=\"text-align:right;\"> 0 </td>\n   <td style=\"text-align:right;\"> 0 </td>\n   <td style=\"text-align:right;\"> 0 </td>\n   <td style=\"text-align:right;\"> 0 </td>\n   <td style=\"text-align:right;\"> 0 </td>\n   <td style=\"text-align:right;\"> 0 </td>\n   <td style=\"text-align:right;\"> 0 </td>\n   <td style=\"text-align:right;\"> 1 </td>\n   <td style=\"text-align:right;\"> 0 </td>\n   <td style=\"text-align:right;\"> 1 </td>\n   <td style=\"text-align:right;\"> 0 </td>\n   <td style=\"text-align:right;\"> 0 </td>\n   <td style=\"text-align:right;\"> 0 </td>\n   <td style=\"text-align:right;\"> 0 </td>\n   <td style=\"text-align:right;\"> 0 </td>\n   <td style=\"text-align:right;\"> 0 </td>\n   <td style=\"text-align:right;\"> 0 </td>\n   <td style=\"text-align:right;\"> 0 </td>\n   <td style=\"text-align:right;\"> 0 </td>\n   <td style=\"text-align:right;\"> 0 </td>\n   <td style=\"text-align:right;\"> 0 </td>\n   <td style=\"text-align:right;\"> 0 </td>\n   <td style=\"text-align:right;\"> 0 </td>\n   <td style=\"text-align:right;\"> 0 </td>\n   <td style=\"text-align:right;\"> 0 </td>\n   <td style=\"text-align:right;\"> 0 </td>\n   <td style=\"text-align:right;\"> 0 </td>\n   <td style=\"text-align:right;\"> 0 </td>\n   <td style=\"text-align:right;\"> 1 </td>\n   <td style=\"text-align:right;\"> 0 </td>\n   <td style=\"text-align:left;\"> no </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:right;\"> 33 </td>\n   <td style=\"text-align:right;\"> 4789 </td>\n   <td style=\"text-align:right;\"> 11 </td>\n   <td style=\"text-align:right;\"> 220 </td>\n   <td style=\"text-align:right;\"> 1 </td>\n   <td style=\"text-align:right;\"> 339 </td>\n   <td style=\"text-align:right;\"> 4 </td>\n   <td style=\"text-align:right;\"> 0 </td>\n   <td style=\"text-align:right;\"> 0 </td>\n   <td style=\"text-align:right;\"> 0 </td>\n   <td style=\"text-align:right;\"> 0 </td>\n   <td style=\"text-align:right;\"> 0 </td>\n   <td style=\"text-align:right;\"> 0 </td>\n   <td style=\"text-align:right;\"> 1 </td>\n   <td style=\"text-align:right;\"> 0 </td>\n   <td style=\"text-align:right;\"> 0 </td>\n   <td style=\"text-align:right;\"> 0 </td>\n   <td style=\"text-align:right;\"> 0 </td>\n   <td style=\"text-align:right;\"> 1 </td>\n   <td style=\"text-align:right;\"> 0 </td>\n   <td style=\"text-align:right;\"> 1 </td>\n   <td style=\"text-align:right;\"> 0 </td>\n   <td style=\"text-align:right;\"> 0 </td>\n   <td style=\"text-align:right;\"> 0 </td>\n   <td style=\"text-align:right;\"> 1 </td>\n   <td style=\"text-align:right;\"> 1 </td>\n   <td style=\"text-align:right;\"> 0 </td>\n   <td style=\"text-align:right;\"> 0 </td>\n   <td style=\"text-align:right;\"> 0 </td>\n   <td style=\"text-align:right;\"> 0 </td>\n   <td style=\"text-align:right;\"> 0 </td>\n   <td style=\"text-align:right;\"> 0 </td>\n   <td style=\"text-align:right;\"> 0 </td>\n   <td style=\"text-align:right;\"> 0 </td>\n   <td style=\"text-align:right;\"> 0 </td>\n   <td style=\"text-align:right;\"> 1 </td>\n   <td style=\"text-align:right;\"> 0 </td>\n   <td style=\"text-align:right;\"> 0 </td>\n   <td style=\"text-align:right;\"> 0 </td>\n   <td style=\"text-align:left;\"> no </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:right;\"> 30 </td>\n   <td style=\"text-align:right;\"> 1476 </td>\n   <td style=\"text-align:right;\"> 3 </td>\n   <td style=\"text-align:right;\"> 199 </td>\n   <td style=\"text-align:right;\"> 4 </td>\n   <td style=\"text-align:right;\"> -1 </td>\n   <td style=\"text-align:right;\"> 0 </td>\n   <td style=\"text-align:right;\"> 0 </td>\n   <td style=\"text-align:right;\"> 0 </td>\n   <td style=\"text-align:right;\"> 0 </td>\n   <td style=\"text-align:right;\"> 1 </td>\n   <td style=\"text-align:right;\"> 0 </td>\n   <td style=\"text-align:right;\"> 0 </td>\n   <td style=\"text-align:right;\"> 0 </td>\n   <td style=\"text-align:right;\"> 0 </td>\n   <td style=\"text-align:right;\"> 0 </td>\n   <td style=\"text-align:right;\"> 0 </td>\n   <td style=\"text-align:right;\"> 0 </td>\n   <td style=\"text-align:right;\"> 1 </td>\n   <td style=\"text-align:right;\"> 0 </td>\n   <td style=\"text-align:right;\"> 0 </td>\n   <td style=\"text-align:right;\"> 1 </td>\n   <td style=\"text-align:right;\"> 0 </td>\n   <td style=\"text-align:right;\"> 0 </td>\n   <td style=\"text-align:right;\"> 1 </td>\n   <td style=\"text-align:right;\"> 1 </td>\n   <td style=\"text-align:right;\"> 0 </td>\n   <td style=\"text-align:right;\"> 1 </td>\n   <td style=\"text-align:right;\"> 0 </td>\n   <td style=\"text-align:right;\"> 0 </td>\n   <td style=\"text-align:right;\"> 0 </td>\n   <td style=\"text-align:right;\"> 0 </td>\n   <td style=\"text-align:right;\"> 0 </td>\n   <td style=\"text-align:right;\"> 1 </td>\n   <td style=\"text-align:right;\"> 0 </td>\n   <td style=\"text-align:right;\"> 0 </td>\n   <td style=\"text-align:right;\"> 0 </td>\n   <td style=\"text-align:right;\"> 0 </td>\n   <td style=\"text-align:right;\"> 0 </td>\n   <td style=\"text-align:left;\"> no </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:right;\"> 59 </td>\n   <td style=\"text-align:right;\"> 0 </td>\n   <td style=\"text-align:right;\"> 5 </td>\n   <td style=\"text-align:right;\"> 226 </td>\n   <td style=\"text-align:right;\"> 1 </td>\n   <td style=\"text-align:right;\"> -1 </td>\n   <td style=\"text-align:right;\"> 0 </td>\n   <td style=\"text-align:right;\"> 1 </td>\n   <td style=\"text-align:right;\"> 0 </td>\n   <td style=\"text-align:right;\"> 0 </td>\n   <td style=\"text-align:right;\"> 0 </td>\n   <td style=\"text-align:right;\"> 0 </td>\n   <td style=\"text-align:right;\"> 0 </td>\n   <td style=\"text-align:right;\"> 0 </td>\n   <td style=\"text-align:right;\"> 0 </td>\n   <td style=\"text-align:right;\"> 0 </td>\n   <td style=\"text-align:right;\"> 0 </td>\n   <td style=\"text-align:right;\"> 0 </td>\n   <td style=\"text-align:right;\"> 1 </td>\n   <td style=\"text-align:right;\"> 0 </td>\n   <td style=\"text-align:right;\"> 1 </td>\n   <td style=\"text-align:right;\"> 0 </td>\n   <td style=\"text-align:right;\"> 0 </td>\n   <td style=\"text-align:right;\"> 0 </td>\n   <td style=\"text-align:right;\"> 1 </td>\n   <td style=\"text-align:right;\"> 0 </td>\n   <td style=\"text-align:right;\"> 0 </td>\n   <td style=\"text-align:right;\"> 1 </td>\n   <td style=\"text-align:right;\"> 0 </td>\n   <td style=\"text-align:right;\"> 0 </td>\n   <td style=\"text-align:right;\"> 0 </td>\n   <td style=\"text-align:right;\"> 0 </td>\n   <td style=\"text-align:right;\"> 0 </td>\n   <td style=\"text-align:right;\"> 0 </td>\n   <td style=\"text-align:right;\"> 0 </td>\n   <td style=\"text-align:right;\"> 1 </td>\n   <td style=\"text-align:right;\"> 0 </td>\n   <td style=\"text-align:right;\"> 0 </td>\n   <td style=\"text-align:right;\"> 0 </td>\n   <td style=\"text-align:left;\"> no </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:right;\"> 36 </td>\n   <td style=\"text-align:right;\"> 307 </td>\n   <td style=\"text-align:right;\"> 14 </td>\n   <td style=\"text-align:right;\"> 341 </td>\n   <td style=\"text-align:right;\"> 1 </td>\n   <td style=\"text-align:right;\"> 330 </td>\n   <td style=\"text-align:right;\"> 2 </td>\n   <td style=\"text-align:right;\"> 0 </td>\n   <td style=\"text-align:right;\"> 0 </td>\n   <td style=\"text-align:right;\"> 0 </td>\n   <td style=\"text-align:right;\"> 0 </td>\n   <td style=\"text-align:right;\"> 0 </td>\n   <td style=\"text-align:right;\"> 1 </td>\n   <td style=\"text-align:right;\"> 0 </td>\n   <td style=\"text-align:right;\"> 0 </td>\n   <td style=\"text-align:right;\"> 0 </td>\n   <td style=\"text-align:right;\"> 0 </td>\n   <td style=\"text-align:right;\"> 0 </td>\n   <td style=\"text-align:right;\"> 1 </td>\n   <td style=\"text-align:right;\"> 0 </td>\n   <td style=\"text-align:right;\"> 0 </td>\n   <td style=\"text-align:right;\"> 1 </td>\n   <td style=\"text-align:right;\"> 0 </td>\n   <td style=\"text-align:right;\"> 0 </td>\n   <td style=\"text-align:right;\"> 1 </td>\n   <td style=\"text-align:right;\"> 0 </td>\n   <td style=\"text-align:right;\"> 0 </td>\n   <td style=\"text-align:right;\"> 0 </td>\n   <td style=\"text-align:right;\"> 0 </td>\n   <td style=\"text-align:right;\"> 0 </td>\n   <td style=\"text-align:right;\"> 0 </td>\n   <td style=\"text-align:right;\"> 0 </td>\n   <td style=\"text-align:right;\"> 0 </td>\n   <td style=\"text-align:right;\"> 0 </td>\n   <td style=\"text-align:right;\"> 0 </td>\n   <td style=\"text-align:right;\"> 1 </td>\n   <td style=\"text-align:right;\"> 0 </td>\n   <td style=\"text-align:right;\"> 0 </td>\n   <td style=\"text-align:right;\"> 0 </td>\n   <td style=\"text-align:left;\"> no </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:right;\"> 39 </td>\n   <td style=\"text-align:right;\"> 147 </td>\n   <td style=\"text-align:right;\"> 6 </td>\n   <td style=\"text-align:right;\"> 151 </td>\n   <td style=\"text-align:right;\"> 2 </td>\n   <td style=\"text-align:right;\"> -1 </td>\n   <td style=\"text-align:right;\"> 0 </td>\n   <td style=\"text-align:right;\"> 0 </td>\n   <td style=\"text-align:right;\"> 0 </td>\n   <td style=\"text-align:right;\"> 0 </td>\n   <td style=\"text-align:right;\"> 0 </td>\n   <td style=\"text-align:right;\"> 0 </td>\n   <td style=\"text-align:right;\"> 0 </td>\n   <td style=\"text-align:right;\"> 0 </td>\n   <td style=\"text-align:right;\"> 0 </td>\n   <td style=\"text-align:right;\"> 1 </td>\n   <td style=\"text-align:right;\"> 0 </td>\n   <td style=\"text-align:right;\"> 0 </td>\n   <td style=\"text-align:right;\"> 1 </td>\n   <td style=\"text-align:right;\"> 0 </td>\n   <td style=\"text-align:right;\"> 1 </td>\n   <td style=\"text-align:right;\"> 0 </td>\n   <td style=\"text-align:right;\"> 0 </td>\n   <td style=\"text-align:right;\"> 0 </td>\n   <td style=\"text-align:right;\"> 1 </td>\n   <td style=\"text-align:right;\"> 0 </td>\n   <td style=\"text-align:right;\"> 0 </td>\n   <td style=\"text-align:right;\"> 0 </td>\n   <td style=\"text-align:right;\"> 0 </td>\n   <td style=\"text-align:right;\"> 0 </td>\n   <td style=\"text-align:right;\"> 0 </td>\n   <td style=\"text-align:right;\"> 0 </td>\n   <td style=\"text-align:right;\"> 0 </td>\n   <td style=\"text-align:right;\"> 0 </td>\n   <td style=\"text-align:right;\"> 0 </td>\n   <td style=\"text-align:right;\"> 1 </td>\n   <td style=\"text-align:right;\"> 0 </td>\n   <td style=\"text-align:right;\"> 0 </td>\n   <td style=\"text-align:right;\"> 0 </td>\n   <td style=\"text-align:left;\"> no </td>\n  </tr>\n</tbody>\n</table>\n\n`````\n:::\n:::\n\n\n\n\n## Create validation set\n\n> So, how good is the model? Not so fast...\n\nWe could actually build the model and evaluate its performance. The problem with that approach is the sample. \n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ncv_folds <- recipes::bake(\n  bank_recipe,\n  new_data = bank_train) %>%\n  rsample::vfold_cv(v = 5, strata = y)\n```\n:::\n\n\n\n\n## Specify models\n\n\nNext, parsnip helps us to specify our models. Initially, I will define a LightGBM model,\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlightgbm_model<- parsnip::boost_tree(\n mode = \"classification\",\n trees = 100,\n min_n = tune(),\n learn_rate = tune(),\n tree_depth = tune()) %>%\nset_engine(\"lightgbm\", loss_function = \"squarederror\")\n```\n:::\n\n\n\n\nand an XGBoost one.\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nxgboost_model<- parsnip::boost_tree(\n mode = \"classification\",\n trees = 100,\n min_n = tune(),\n learn_rate = tune(),\n tree_depth = tune()) %>%\n set_engine(\"xgboost\")\n```\n:::\n\n\n\n\n\n## Hyperparameters tuning\n\nNow, we are specifying the hyperpaterers' values and a grid to check which combination of those are performing better according to our desired metric (in our case ROC). This has to be done for both, LightGBM \n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlightgbm_params <- dials::parameters(\n min_n(),\n tree_depth(range = c(4,10)),\n learn_rate() # learning rate\n)\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nlightgbm_grid <- dials::grid_max_entropy(\n lightgbm_params,\n size = 10)\n\nhead(lightgbm_grid) %>%\n  kbl(toprule = T,align = 'c',booktabs = T)  %>%\n  kable_styling(full_width = F, position = \"center\", html_font = \"Cambria\") \n```\n\n::: {.cell-output-display}\n`````{=html}\n<table class=\"table\" style=\"font-family: Cambria; width: auto !important; margin-left: auto; margin-right: auto;\">\n <thead>\n  <tr>\n   <th style=\"text-align:center;\"> min_n </th>\n   <th style=\"text-align:center;\"> tree_depth </th>\n   <th style=\"text-align:center;\"> learn_rate </th>\n  </tr>\n </thead>\n<tbody>\n  <tr>\n   <td style=\"text-align:center;\"> 3 </td>\n   <td style=\"text-align:center;\"> 5 </td>\n   <td style=\"text-align:center;\"> 0.00 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:center;\"> 3 </td>\n   <td style=\"text-align:center;\"> 7 </td>\n   <td style=\"text-align:center;\"> 0.00 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:center;\"> 11 </td>\n   <td style=\"text-align:center;\"> 10 </td>\n   <td style=\"text-align:center;\"> 0.00 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:center;\"> 33 </td>\n   <td style=\"text-align:center;\"> 4 </td>\n   <td style=\"text-align:center;\"> 0.08 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:center;\"> 10 </td>\n   <td style=\"text-align:center;\"> 5 </td>\n   <td style=\"text-align:center;\"> 0.01 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:center;\"> 31 </td>\n   <td style=\"text-align:center;\"> 9 </td>\n   <td style=\"text-align:center;\"> 0.00 </td>\n  </tr>\n</tbody>\n</table>\n\n`````\n:::\n:::\n\n\n\n\nand XGBoost.\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nxgboost_params <- dials::parameters(\n min_n(),\n tree_depth(range = c(4,10)),\n learn_rate() # learning rate\n)\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nxgboost_grid <- dials::grid_max_entropy(\n  xgboost_params,\n  size = 10\n)\n\nhead(xgboost_grid) %>%\n  kbl(toprule = T,align = 'c',booktabs = T)  %>%\n  kable_styling(full_width = F, position = \"center\", html_font = \"Cambria\") \n```\n\n::: {.cell-output-display}\n`````{=html}\n<table class=\"table\" style=\"font-family: Cambria; width: auto !important; margin-left: auto; margin-right: auto;\">\n <thead>\n  <tr>\n   <th style=\"text-align:center;\"> min_n </th>\n   <th style=\"text-align:center;\"> tree_depth </th>\n   <th style=\"text-align:center;\"> learn_rate </th>\n  </tr>\n </thead>\n<tbody>\n  <tr>\n   <td style=\"text-align:center;\"> 5 </td>\n   <td style=\"text-align:center;\"> 6 </td>\n   <td style=\"text-align:center;\"> 0.00 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:center;\"> 4 </td>\n   <td style=\"text-align:center;\"> 8 </td>\n   <td style=\"text-align:center;\"> 0.00 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:center;\"> 37 </td>\n   <td style=\"text-align:center;\"> 9 </td>\n   <td style=\"text-align:center;\"> 0.00 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:center;\"> 2 </td>\n   <td style=\"text-align:center;\"> 5 </td>\n   <td style=\"text-align:center;\"> 0.00 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:center;\"> 21 </td>\n   <td style=\"text-align:center;\"> 9 </td>\n   <td style=\"text-align:center;\"> 0.01 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:center;\"> 21 </td>\n   <td style=\"text-align:center;\"> 5 </td>\n   <td style=\"text-align:center;\"> 0.05 </td>\n  </tr>\n</tbody>\n</table>\n\n`````\n:::\n:::\n\n\n\n\n\n\n## Fit resamples\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# build workflow for LightGBM\n\nlightgbm_workflow <- workflows::workflow() %>%\n add_model(lightgbm_model) %>%\n add_formula(y ~.)\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\n# build workflow for XGBoost\n\nxgboost_workflow <- workflows::workflow() %>%\n  add_model(xgboost_model) %>%\n  add_formula(y~.)\n```\n:::\n\n\n\n\nFinally, we can build the LightGBM model by combining :\n\n- The workflows we set it up above\n- The resamples\n- Grid of values (hyperparameters)\n- Metric based on which we will evaluate our model's performance\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nstart_time_lightgbm <- Sys.time()\n\nlightgbm_tuned_model <- tune::tune_grid(\n object = lightgbm_workflow,\n resamples = cv_folds,\n metrics = metric_set(roc_auc, accuracy),\n grid = lightgbm_grid,\n control = tune::control_grid(verbose = FALSE) # set this to TRUE to see\n # in what step of the process you are. But that doesn't look that well in\n # a blog.\n)\n\nend_time_lightgbm <- Sys.time()\n\ntime_lightgbm = difftime(end_time_lightgbm,start_time_lightgbm,units = \"secs\")\n```\n:::\n\n\n\n\nSimilarly, for XGBoost. \n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nstart_time_xgboost <- Sys.time()\n\nxgboost_tuned_model <- tune::tune_grid(\n object = xgboost_workflow,\n resamples = cv_folds,\n metrics = metric_set(roc_auc, accuracy),\n grid = xgboost_grid,\n control = tune::control_grid(verbose = FALSE) # set this to TRUE to see\n # in what step of the process you are. But that doesn't look that well in\n # a blog.\n)\n\nend_time_xgboost <- Sys.time()\n\ntime_xgboost= difftime(end_time_xgboost,start_time_xgboost,units = \"secs\")\n```\n:::\n\n\n\n\n## Evaluate model\n\nOur first results based on resamples for LightGBM\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlightgbm_tuned_model %>%\n  show_best(\"roc_auc\",n=5) %>% \n  kbl(toprule = T,align = 'c',booktabs = T)  %>%\n  kable_styling(full_width = F, position = \"center\", html_font = \"Cambria\") \n```\n\n::: {.cell-output-display}\n`````{=html}\n<table class=\"table\" style=\"font-family: Cambria; width: auto !important; margin-left: auto; margin-right: auto;\">\n <thead>\n  <tr>\n   <th style=\"text-align:center;\"> min_n </th>\n   <th style=\"text-align:center;\"> tree_depth </th>\n   <th style=\"text-align:center;\"> learn_rate </th>\n   <th style=\"text-align:center;\"> .metric </th>\n   <th style=\"text-align:center;\"> .estimator </th>\n   <th style=\"text-align:center;\"> mean </th>\n   <th style=\"text-align:center;\"> n </th>\n   <th style=\"text-align:center;\"> std_err </th>\n   <th style=\"text-align:center;\"> .config </th>\n  </tr>\n </thead>\n<tbody>\n  <tr>\n   <td style=\"text-align:center;\"> 33 </td>\n   <td style=\"text-align:center;\"> 4 </td>\n   <td style=\"text-align:center;\"> 0.08 </td>\n   <td style=\"text-align:center;\"> roc_auc </td>\n   <td style=\"text-align:center;\"> binary </td>\n   <td style=\"text-align:center;\"> 0.90 </td>\n   <td style=\"text-align:center;\"> 5 </td>\n   <td style=\"text-align:center;\"> 0.01 </td>\n   <td style=\"text-align:center;\"> Preprocessor1_Model04 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:center;\"> 16 </td>\n   <td style=\"text-align:center;\"> 10 </td>\n   <td style=\"text-align:center;\"> 0.06 </td>\n   <td style=\"text-align:center;\"> roc_auc </td>\n   <td style=\"text-align:center;\"> binary </td>\n   <td style=\"text-align:center;\"> 0.90 </td>\n   <td style=\"text-align:center;\"> 5 </td>\n   <td style=\"text-align:center;\"> 0.01 </td>\n   <td style=\"text-align:center;\"> Preprocessor1_Model10 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:center;\"> 10 </td>\n   <td style=\"text-align:center;\"> 5 </td>\n   <td style=\"text-align:center;\"> 0.01 </td>\n   <td style=\"text-align:center;\"> roc_auc </td>\n   <td style=\"text-align:center;\"> binary </td>\n   <td style=\"text-align:center;\"> 0.89 </td>\n   <td style=\"text-align:center;\"> 5 </td>\n   <td style=\"text-align:center;\"> 0.01 </td>\n   <td style=\"text-align:center;\"> Preprocessor1_Model05 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:center;\"> 34 </td>\n   <td style=\"text-align:center;\"> 10 </td>\n   <td style=\"text-align:center;\"> 0.00 </td>\n   <td style=\"text-align:center;\"> roc_auc </td>\n   <td style=\"text-align:center;\"> binary </td>\n   <td style=\"text-align:center;\"> 0.86 </td>\n   <td style=\"text-align:center;\"> 5 </td>\n   <td style=\"text-align:center;\"> 0.01 </td>\n   <td style=\"text-align:center;\"> Preprocessor1_Model07 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:center;\"> 29 </td>\n   <td style=\"text-align:center;\"> 6 </td>\n   <td style=\"text-align:center;\"> 0.00 </td>\n   <td style=\"text-align:center;\"> roc_auc </td>\n   <td style=\"text-align:center;\"> binary </td>\n   <td style=\"text-align:center;\"> 0.86 </td>\n   <td style=\"text-align:center;\"> 5 </td>\n   <td style=\"text-align:center;\"> 0.01 </td>\n   <td style=\"text-align:center;\"> Preprocessor1_Model09 </td>\n  </tr>\n</tbody>\n</table>\n\n`````\n:::\n:::\n\n\n\n\nand XGBoost\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nxgboost_tuned_model %>%\n  show_best(\"roc_auc\",n=5) %>% \n  kbl(toprule = T,align = 'c',booktabs = T)  %>%\n  kable_styling(full_width = F, position = \"center\", html_font = \"Cambria\") \n```\n\n::: {.cell-output-display}\n`````{=html}\n<table class=\"table\" style=\"font-family: Cambria; width: auto !important; margin-left: auto; margin-right: auto;\">\n <thead>\n  <tr>\n   <th style=\"text-align:center;\"> min_n </th>\n   <th style=\"text-align:center;\"> tree_depth </th>\n   <th style=\"text-align:center;\"> learn_rate </th>\n   <th style=\"text-align:center;\"> .metric </th>\n   <th style=\"text-align:center;\"> .estimator </th>\n   <th style=\"text-align:center;\"> mean </th>\n   <th style=\"text-align:center;\"> n </th>\n   <th style=\"text-align:center;\"> std_err </th>\n   <th style=\"text-align:center;\"> .config </th>\n  </tr>\n </thead>\n<tbody>\n  <tr>\n   <td style=\"text-align:center;\"> 21 </td>\n   <td style=\"text-align:center;\"> 5 </td>\n   <td style=\"text-align:center;\"> 0.05 </td>\n   <td style=\"text-align:center;\"> roc_auc </td>\n   <td style=\"text-align:center;\"> binary </td>\n   <td style=\"text-align:center;\"> 0.88 </td>\n   <td style=\"text-align:center;\"> 5 </td>\n   <td style=\"text-align:center;\"> 0.01 </td>\n   <td style=\"text-align:center;\"> Preprocessor1_Model06 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:center;\"> 21 </td>\n   <td style=\"text-align:center;\"> 9 </td>\n   <td style=\"text-align:center;\"> 0.01 </td>\n   <td style=\"text-align:center;\"> roc_auc </td>\n   <td style=\"text-align:center;\"> binary </td>\n   <td style=\"text-align:center;\"> 0.85 </td>\n   <td style=\"text-align:center;\"> 5 </td>\n   <td style=\"text-align:center;\"> 0.01 </td>\n   <td style=\"text-align:center;\"> Preprocessor1_Model05 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:center;\"> 5 </td>\n   <td style=\"text-align:center;\"> 6 </td>\n   <td style=\"text-align:center;\"> 0.00 </td>\n   <td style=\"text-align:center;\"> roc_auc </td>\n   <td style=\"text-align:center;\"> binary </td>\n   <td style=\"text-align:center;\"> 0.84 </td>\n   <td style=\"text-align:center;\"> 5 </td>\n   <td style=\"text-align:center;\"> 0.01 </td>\n   <td style=\"text-align:center;\"> Preprocessor1_Model01 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:center;\"> 40 </td>\n   <td style=\"text-align:center;\"> 5 </td>\n   <td style=\"text-align:center;\"> 0.00 </td>\n   <td style=\"text-align:center;\"> roc_auc </td>\n   <td style=\"text-align:center;\"> binary </td>\n   <td style=\"text-align:center;\"> 0.83 </td>\n   <td style=\"text-align:center;\"> 5 </td>\n   <td style=\"text-align:center;\"> 0.01 </td>\n   <td style=\"text-align:center;\"> Preprocessor1_Model08 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:center;\"> 19 </td>\n   <td style=\"text-align:center;\"> 7 </td>\n   <td style=\"text-align:center;\"> 0.00 </td>\n   <td style=\"text-align:center;\"> roc_auc </td>\n   <td style=\"text-align:center;\"> binary </td>\n   <td style=\"text-align:center;\"> 0.83 </td>\n   <td style=\"text-align:center;\"> 5 </td>\n   <td style=\"text-align:center;\"> 0.01 </td>\n   <td style=\"text-align:center;\"> Preprocessor1_Model07 </td>\n  </tr>\n</tbody>\n</table>\n\n`````\n:::\n:::\n\n\n\n\n## Last fit\n\nBy now we can assess which is the best combination of values. Given those I will assess my model's performance on unknown (to my model) data. LightGBM model has 0.8469 ROC-value\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlast_fit_lightgbm_model = parsnip::boost_tree(\n mode = \"classification\",\n trees = 100,\n min_n = 33,\n learn_rate = 0.0787,\n tree_depth = 4) %>%\nset_engine(\"lightgbm\", loss_function = \"squarederror\")\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\noptions(digits = 4)\n\nlast_fit_workflow <- lightgbm_workflow %>% \n  update_model(last_fit_lightgbm_model)\n\nlast_lightgbm_fit <- \n  last_fit_workflow %>% \n  last_fit(bank_dataset_split)\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\n! train/test split: preprocessor 1/1, model 1/1: NAs introduced by coercion\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\n! train/test split: preprocessor 1/1, model 1/1 (predictions): NAs introduced by coercion\n```\n\n\n:::\n\n```{.r .cell-code}\nlast_lightgbm_fit %>% \n  collect_metrics() %>%\n  kbl(toprule = T,align = 'c',booktabs = T)  %>%\n  kable_styling(full_width = F, position = \"center\", html_font = \"Cambria\") \n```\n\n::: {.cell-output-display}\n`````{=html}\n<table class=\"table\" style=\"font-family: Cambria; width: auto !important; margin-left: auto; margin-right: auto;\">\n <thead>\n  <tr>\n   <th style=\"text-align:center;\"> .metric </th>\n   <th style=\"text-align:center;\"> .estimator </th>\n   <th style=\"text-align:center;\"> .estimate </th>\n   <th style=\"text-align:center;\"> .config </th>\n  </tr>\n </thead>\n<tbody>\n  <tr>\n   <td style=\"text-align:center;\"> accuracy </td>\n   <td style=\"text-align:center;\"> binary </td>\n   <td style=\"text-align:center;\"> 0.8833 </td>\n   <td style=\"text-align:center;\"> Preprocessor1_Model1 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:center;\"> roc_auc </td>\n   <td style=\"text-align:center;\"> binary </td>\n   <td style=\"text-align:center;\"> 0.8471 </td>\n   <td style=\"text-align:center;\"> Preprocessor1_Model1 </td>\n  </tr>\n</tbody>\n</table>\n\n`````\n:::\n:::\n\n\n\n\n\nand XGBoost, 0.8736.\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlast_fit_xgboost_model = parsnip::boost_tree(\n mode = \"classification\",\n trees = 100,\n min_n = 21,\n learn_rate = 0.0472,\n tree_depth = 5) %>%\nset_engine(\"xgboost\")\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\noptions(digits = 4)\n\nlast_fit_xgboost_workflow <- xgboost_workflow %>% \n  update_model(last_fit_xgboost_model)\n\nlast_xgboost_fit <- \n  last_fit_xgboost_workflow %>% \n  last_fit(bank_dataset_split)\n\nlast_xgboost_fit %>% \n  collect_metrics() %>%\n  kbl(toprule = T,align = 'c',booktabs = T)  %>%\n  kable_styling(full_width = F, position = \"center\", html_font = \"Cambria\") \n```\n\n::: {.cell-output-display}\n`````{=html}\n<table class=\"table\" style=\"font-family: Cambria; width: auto !important; margin-left: auto; margin-right: auto;\">\n <thead>\n  <tr>\n   <th style=\"text-align:center;\"> .metric </th>\n   <th style=\"text-align:center;\"> .estimator </th>\n   <th style=\"text-align:center;\"> .estimate </th>\n   <th style=\"text-align:center;\"> .config </th>\n  </tr>\n </thead>\n<tbody>\n  <tr>\n   <td style=\"text-align:center;\"> accuracy </td>\n   <td style=\"text-align:center;\"> binary </td>\n   <td style=\"text-align:center;\"> 0.8921 </td>\n   <td style=\"text-align:center;\"> Preprocessor1_Model1 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:center;\"> roc_auc </td>\n   <td style=\"text-align:center;\"> binary </td>\n   <td style=\"text-align:center;\"> 0.8693 </td>\n   <td style=\"text-align:center;\"> Preprocessor1_Model1 </td>\n  </tr>\n</tbody>\n</table>\n\n`````\n:::\n:::\n\n\n\n\n\n# Results\n\n\nIt seems that my model has a really good predictive value even if I applied a relatively simple model. If an increased accuracy is justified we can apply a more powerful model (e.g., XGBoost, CatBoost, etc..).\n\nTo summarize, \n\n| Model    | Time to build  | ROC value (test)  | ROC value (CV) |\n| :----:   |    :----:   |    :----:    | :----: | \n| LightGBM | 24.19 sec. | 0.8469  | 0.903 |\n| XGBoost  | 73.72 sec.  | 0.8736  | 0.881 |\n\nIn conclusion LightGBM model is less time consuming in comparison with XGBoost. On the other hand, XGBoost model needed more time to be built (which was expected) but outperformed LightGBM. \n\nSo, we got some results, so what? The main question is still unanswered. All this modelling was about to find out who is interested to a term deposit. Usually, I would use predict function with the corresponding data to mark my predictions. However, I wasn't able to do that as I received an error about class. Nevermind, the function collect_predictions() does the same. \n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\npr = last_lightgbm_fit %>% collect_predictions()\n```\n:::\n\n\n\n\nNow, I will select the predicted value and the result and I will paste them on my test data. \n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\npr = pr %>% select(.pred_class, y) \n\nfinal = cbind(pr, bank_test)\n```\n:::\n\n\n\n\nAnd now let's say that I want to give a list of only the interested ones. I will filter pred class to show only \"Yes\" values. We should also take into consideration that the dataset does not include any personal information, so I will also include  an ID.\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nfinal %>% \n  head() %>%\n  kbl(toprule = T,align = 'c',booktabs = T)  %>%\n  kable_styling(full_width = F, position = \"center\", html_font = \"Cambria\") \n```\n\n::: {.cell-output-display}\n`````{=html}\n<table class=\"table\" style=\"font-family: Cambria; width: auto !important; margin-left: auto; margin-right: auto;\">\n <thead>\n  <tr>\n   <th style=\"text-align:center;\"> .pred_class </th>\n   <th style=\"text-align:center;\"> y </th>\n   <th style=\"text-align:center;\"> ID </th>\n   <th style=\"text-align:center;\"> age </th>\n   <th style=\"text-align:center;\"> job </th>\n   <th style=\"text-align:center;\"> marital </th>\n   <th style=\"text-align:center;\"> education </th>\n   <th style=\"text-align:center;\"> default </th>\n   <th style=\"text-align:center;\"> balance </th>\n   <th style=\"text-align:center;\"> housing </th>\n   <th style=\"text-align:center;\"> loan </th>\n   <th style=\"text-align:center;\"> contact </th>\n   <th style=\"text-align:center;\"> day </th>\n   <th style=\"text-align:center;\"> month </th>\n   <th style=\"text-align:center;\"> duration </th>\n   <th style=\"text-align:center;\"> campaign </th>\n   <th style=\"text-align:center;\"> pdays </th>\n   <th style=\"text-align:center;\"> previous </th>\n   <th style=\"text-align:center;\"> poutcome </th>\n   <th style=\"text-align:center;\"> y </th>\n  </tr>\n </thead>\n<tbody>\n  <tr>\n   <td style=\"text-align:center;\"> no </td>\n   <td style=\"text-align:center;\"> no </td>\n   <td style=\"text-align:center;\"> 3 </td>\n   <td style=\"text-align:center;\"> 35 </td>\n   <td style=\"text-align:center;\"> management </td>\n   <td style=\"text-align:center;\"> single </td>\n   <td style=\"text-align:center;\"> tertiary </td>\n   <td style=\"text-align:center;\"> no </td>\n   <td style=\"text-align:center;\"> 1350 </td>\n   <td style=\"text-align:center;\"> yes </td>\n   <td style=\"text-align:center;\"> no </td>\n   <td style=\"text-align:center;\"> cellular </td>\n   <td style=\"text-align:center;\"> 16 </td>\n   <td style=\"text-align:center;\"> apr </td>\n   <td style=\"text-align:center;\"> 185 </td>\n   <td style=\"text-align:center;\"> 1 </td>\n   <td style=\"text-align:center;\"> 330 </td>\n   <td style=\"text-align:center;\"> 1 </td>\n   <td style=\"text-align:center;\"> failure </td>\n   <td style=\"text-align:center;\"> no </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:center;\"> no </td>\n   <td style=\"text-align:center;\"> no </td>\n   <td style=\"text-align:center;\"> 6 </td>\n   <td style=\"text-align:center;\"> 35 </td>\n   <td style=\"text-align:center;\"> management </td>\n   <td style=\"text-align:center;\"> single </td>\n   <td style=\"text-align:center;\"> tertiary </td>\n   <td style=\"text-align:center;\"> no </td>\n   <td style=\"text-align:center;\"> 747 </td>\n   <td style=\"text-align:center;\"> no </td>\n   <td style=\"text-align:center;\"> no </td>\n   <td style=\"text-align:center;\"> cellular </td>\n   <td style=\"text-align:center;\"> 23 </td>\n   <td style=\"text-align:center;\"> feb </td>\n   <td style=\"text-align:center;\"> 141 </td>\n   <td style=\"text-align:center;\"> 2 </td>\n   <td style=\"text-align:center;\"> 176 </td>\n   <td style=\"text-align:center;\"> 3 </td>\n   <td style=\"text-align:center;\"> failure </td>\n   <td style=\"text-align:center;\"> no </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:center;\"> no </td>\n   <td style=\"text-align:center;\"> no </td>\n   <td style=\"text-align:center;\"> 15 </td>\n   <td style=\"text-align:center;\"> 31 </td>\n   <td style=\"text-align:center;\"> blue-collar </td>\n   <td style=\"text-align:center;\"> married </td>\n   <td style=\"text-align:center;\"> secondary </td>\n   <td style=\"text-align:center;\"> no </td>\n   <td style=\"text-align:center;\"> 360 </td>\n   <td style=\"text-align:center;\"> yes </td>\n   <td style=\"text-align:center;\"> yes </td>\n   <td style=\"text-align:center;\"> cellular </td>\n   <td style=\"text-align:center;\"> 29 </td>\n   <td style=\"text-align:center;\"> jan </td>\n   <td style=\"text-align:center;\"> 89 </td>\n   <td style=\"text-align:center;\"> 1 </td>\n   <td style=\"text-align:center;\"> 241 </td>\n   <td style=\"text-align:center;\"> 1 </td>\n   <td style=\"text-align:center;\"> failure </td>\n   <td style=\"text-align:center;\"> no </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:center;\"> no </td>\n   <td style=\"text-align:center;\"> no </td>\n   <td style=\"text-align:center;\"> 23 </td>\n   <td style=\"text-align:center;\"> 44 </td>\n   <td style=\"text-align:center;\"> services </td>\n   <td style=\"text-align:center;\"> single </td>\n   <td style=\"text-align:center;\"> secondary </td>\n   <td style=\"text-align:center;\"> no </td>\n   <td style=\"text-align:center;\"> 106 </td>\n   <td style=\"text-align:center;\"> no </td>\n   <td style=\"text-align:center;\"> no </td>\n   <td style=\"text-align:center;\"> unknown </td>\n   <td style=\"text-align:center;\"> 12 </td>\n   <td style=\"text-align:center;\"> jun </td>\n   <td style=\"text-align:center;\"> 109 </td>\n   <td style=\"text-align:center;\"> 2 </td>\n   <td style=\"text-align:center;\"> -1 </td>\n   <td style=\"text-align:center;\"> 0 </td>\n   <td style=\"text-align:center;\"> unknown </td>\n   <td style=\"text-align:center;\"> no </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:center;\"> no </td>\n   <td style=\"text-align:center;\"> yes </td>\n   <td style=\"text-align:center;\"> 51 </td>\n   <td style=\"text-align:center;\"> 45 </td>\n   <td style=\"text-align:center;\"> blue-collar </td>\n   <td style=\"text-align:center;\"> divorced </td>\n   <td style=\"text-align:center;\"> primary </td>\n   <td style=\"text-align:center;\"> no </td>\n   <td style=\"text-align:center;\"> 844 </td>\n   <td style=\"text-align:center;\"> no </td>\n   <td style=\"text-align:center;\"> no </td>\n   <td style=\"text-align:center;\"> unknown </td>\n   <td style=\"text-align:center;\"> 5 </td>\n   <td style=\"text-align:center;\"> jun </td>\n   <td style=\"text-align:center;\"> 1018 </td>\n   <td style=\"text-align:center;\"> 3 </td>\n   <td style=\"text-align:center;\"> -1 </td>\n   <td style=\"text-align:center;\"> 0 </td>\n   <td style=\"text-align:center;\"> unknown </td>\n   <td style=\"text-align:center;\"> yes </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:center;\"> yes </td>\n   <td style=\"text-align:center;\"> no </td>\n   <td style=\"text-align:center;\"> 52 </td>\n   <td style=\"text-align:center;\"> 37 </td>\n   <td style=\"text-align:center;\"> technician </td>\n   <td style=\"text-align:center;\"> single </td>\n   <td style=\"text-align:center;\"> secondary </td>\n   <td style=\"text-align:center;\"> no </td>\n   <td style=\"text-align:center;\"> 228 </td>\n   <td style=\"text-align:center;\"> yes </td>\n   <td style=\"text-align:center;\"> no </td>\n   <td style=\"text-align:center;\"> cellular </td>\n   <td style=\"text-align:center;\"> 20 </td>\n   <td style=\"text-align:center;\"> aug </td>\n   <td style=\"text-align:center;\"> 1740 </td>\n   <td style=\"text-align:center;\"> 2 </td>\n   <td style=\"text-align:center;\"> -1 </td>\n   <td style=\"text-align:center;\"> 0 </td>\n   <td style=\"text-align:center;\"> unknown </td>\n   <td style=\"text-align:center;\"> no </td>\n  </tr>\n</tbody>\n</table>\n\n`````\n:::\n\n```{.r .cell-code}\nfinal %>% select(.pred_class, ID) %>%\n  filter(.pred_class == \"yes\") %>% \n  kbl(toprule = T,align = 'c',booktabs = T)  %>%\n  kable_styling(full_width = F, position = \"center\", html_font = \"Cambria\") %>%\n  scroll_box(width = \"100%\", height = \"200px\")\n```\n\n::: {.cell-output-display}\n`````{=html}\n<div style=\"border: 1px solid #ddd; padding: 0px; overflow-y: scroll; height:200px; overflow-x: scroll; width:100%; \"><table class=\"table\" style=\"font-family: Cambria; width: auto !important; margin-left: auto; margin-right: auto;\">\n <thead>\n  <tr>\n   <th style=\"text-align:center;position: sticky; top:0; background-color: #FFFFFF;\"> .pred_class </th>\n   <th style=\"text-align:center;position: sticky; top:0; background-color: #FFFFFF;\"> ID </th>\n  </tr>\n </thead>\n<tbody>\n  <tr>\n   <td style=\"text-align:center;\"> yes </td>\n   <td style=\"text-align:center;\"> 52 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:center;\"> yes </td>\n   <td style=\"text-align:center;\"> 99 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:center;\"> yes </td>\n   <td style=\"text-align:center;\"> 157 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:center;\"> yes </td>\n   <td style=\"text-align:center;\"> 201 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:center;\"> yes </td>\n   <td style=\"text-align:center;\"> 203 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:center;\"> yes </td>\n   <td style=\"text-align:center;\"> 219 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:center;\"> yes </td>\n   <td style=\"text-align:center;\"> 242 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:center;\"> yes </td>\n   <td style=\"text-align:center;\"> 299 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:center;\"> yes </td>\n   <td style=\"text-align:center;\"> 301 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:center;\"> yes </td>\n   <td style=\"text-align:center;\"> 355 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:center;\"> yes </td>\n   <td style=\"text-align:center;\"> 495 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:center;\"> yes </td>\n   <td style=\"text-align:center;\"> 685 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:center;\"> yes </td>\n   <td style=\"text-align:center;\"> 703 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:center;\"> yes </td>\n   <td style=\"text-align:center;\"> 806 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:center;\"> yes </td>\n   <td style=\"text-align:center;\"> 960 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:center;\"> yes </td>\n   <td style=\"text-align:center;\"> 1127 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:center;\"> yes </td>\n   <td style=\"text-align:center;\"> 1176 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:center;\"> yes </td>\n   <td style=\"text-align:center;\"> 1193 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:center;\"> yes </td>\n   <td style=\"text-align:center;\"> 1277 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:center;\"> yes </td>\n   <td style=\"text-align:center;\"> 1279 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:center;\"> yes </td>\n   <td style=\"text-align:center;\"> 1280 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:center;\"> yes </td>\n   <td style=\"text-align:center;\"> 1350 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:center;\"> yes </td>\n   <td style=\"text-align:center;\"> 1370 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:center;\"> yes </td>\n   <td style=\"text-align:center;\"> 1432 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:center;\"> yes </td>\n   <td style=\"text-align:center;\"> 1455 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:center;\"> yes </td>\n   <td style=\"text-align:center;\"> 1502 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:center;\"> yes </td>\n   <td style=\"text-align:center;\"> 1593 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:center;\"> yes </td>\n   <td style=\"text-align:center;\"> 1764 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:center;\"> yes </td>\n   <td style=\"text-align:center;\"> 1878 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:center;\"> yes </td>\n   <td style=\"text-align:center;\"> 1904 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:center;\"> yes </td>\n   <td style=\"text-align:center;\"> 1915 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:center;\"> yes </td>\n   <td style=\"text-align:center;\"> 1946 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:center;\"> yes </td>\n   <td style=\"text-align:center;\"> 1992 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:center;\"> yes </td>\n   <td style=\"text-align:center;\"> 2038 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:center;\"> yes </td>\n   <td style=\"text-align:center;\"> 2056 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:center;\"> yes </td>\n   <td style=\"text-align:center;\"> 2139 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:center;\"> yes </td>\n   <td style=\"text-align:center;\"> 2160 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:center;\"> yes </td>\n   <td style=\"text-align:center;\"> 2203 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:center;\"> yes </td>\n   <td style=\"text-align:center;\"> 2214 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:center;\"> yes </td>\n   <td style=\"text-align:center;\"> 2218 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:center;\"> yes </td>\n   <td style=\"text-align:center;\"> 2255 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:center;\"> yes </td>\n   <td style=\"text-align:center;\"> 2259 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:center;\"> yes </td>\n   <td style=\"text-align:center;\"> 2432 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:center;\"> yes </td>\n   <td style=\"text-align:center;\"> 2465 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:center;\"> yes </td>\n   <td style=\"text-align:center;\"> 2481 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:center;\"> yes </td>\n   <td style=\"text-align:center;\"> 2652 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:center;\"> yes </td>\n   <td style=\"text-align:center;\"> 2655 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:center;\"> yes </td>\n   <td style=\"text-align:center;\"> 2666 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:center;\"> yes </td>\n   <td style=\"text-align:center;\"> 2732 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:center;\"> yes </td>\n   <td style=\"text-align:center;\"> 2761 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:center;\"> yes </td>\n   <td style=\"text-align:center;\"> 2828 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:center;\"> yes </td>\n   <td style=\"text-align:center;\"> 2920 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:center;\"> yes </td>\n   <td style=\"text-align:center;\"> 3420 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:center;\"> yes </td>\n   <td style=\"text-align:center;\"> 3590 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:center;\"> yes </td>\n   <td style=\"text-align:center;\"> 3615 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:center;\"> yes </td>\n   <td style=\"text-align:center;\"> 3645 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:center;\"> yes </td>\n   <td style=\"text-align:center;\"> 3659 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:center;\"> yes </td>\n   <td style=\"text-align:center;\"> 3738 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:center;\"> yes </td>\n   <td style=\"text-align:center;\"> 3751 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:center;\"> yes </td>\n   <td style=\"text-align:center;\"> 3755 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:center;\"> yes </td>\n   <td style=\"text-align:center;\"> 3787 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:center;\"> yes </td>\n   <td style=\"text-align:center;\"> 3795 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:center;\"> yes </td>\n   <td style=\"text-align:center;\"> 3862 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:center;\"> yes </td>\n   <td style=\"text-align:center;\"> 3932 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:center;\"> yes </td>\n   <td style=\"text-align:center;\"> 3957 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:center;\"> yes </td>\n   <td style=\"text-align:center;\"> 3969 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:center;\"> yes </td>\n   <td style=\"text-align:center;\"> 4055 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:center;\"> yes </td>\n   <td style=\"text-align:center;\"> 4067 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:center;\"> yes </td>\n   <td style=\"text-align:center;\"> 4124 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:center;\"> yes </td>\n   <td style=\"text-align:center;\"> 4214 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:center;\"> yes </td>\n   <td style=\"text-align:center;\"> 4224 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:center;\"> yes </td>\n   <td style=\"text-align:center;\"> 4233 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:center;\"> yes </td>\n   <td style=\"text-align:center;\"> 4263 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:center;\"> yes </td>\n   <td style=\"text-align:center;\"> 4481 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:center;\"> yes </td>\n   <td style=\"text-align:center;\"> 4504 </td>\n  </tr>\n</tbody>\n</table></div>\n\n`````\n:::\n:::\n\n\n\n\nSo, from 1131 possible clients, I finally got 75 that are actually interested. So, I reduced the required phone calls by 93 \\% (and therefore the working hours allocated to this task). But at what cost ? \n\n# Hypothesis\n\nLet's suppose we have to launch a new campaign and inform the interested parties. There are two options. The traditional one, in which case we should call everyone (1131 people). On the other hand, we can use a machine learning (ML) model (given that I have some data) to 'interrupt' some of them. I am also assuming that a phone call lasts, on average, 4 minutes. Additionally, based on Eurostat, the average hourly wage is 30.5 euros.\n\nTo call everyone, we would need 4,524 minutes, which corresponds to 75.4 working hours and therefore amounts to 2,300 euros. By using the model, we would only require 75 calls, equivalent to 5 working hours and 152.5 euros. Even in this simple example (with so few observations), we can see a significant benefit for the company. Last but not least, the company won't disappoint any customers by promoting something they are not interested in, potentially losing clients. Therefore, ML modeling will help not only financially but also in maintaining a healthy brand.\n\n# Acknowledgements {.appendix .unlisted}\n\nImage by <a href=\"https://pixabay.com/users/geralt-9301/?utm_source=link-attribution&amp;utm_medium=referral&amp;utm_campaign=image&amp;utm_content=563967\">Gerd Altmann</a> from <a href=\"https://pixabay.com//?utm_source=link-attribution&amp;utm_medium=referral&amp;utm_campaign=image&amp;utm_content=563967\">Pixabay</a>\n\n\n# References {.appendix .unlisted}\n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {
      "include-in-header": [
        "<script src=\"../../site_libs/kePrint-0.0.1/kePrint.js\"></script>\n<link href=\"../../site_libs/lightable-0.0.1/lightable.css\" rel=\"stylesheet\" />\n"
      ]
    },
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}