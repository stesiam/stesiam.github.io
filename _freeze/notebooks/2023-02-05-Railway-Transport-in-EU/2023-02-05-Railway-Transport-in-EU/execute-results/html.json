{
  "hash": "dda4cceaa114022c472326d8a8baa08f",
  "result": {
    "markdown": "---\ntitle: \"Railway Transport in EU\"\nauthor: \"stesiam\"\ndescription: |\n  An analysis on railway trasport in Europe.\ncategories: [R, Eurostat, EDA, Maps]\nimage: railway.jpg\nfreeze: true\nfig-cap-location: bottom\ndate: \"2023-02-05\"\ntoc: true\ntoc-title: Table of contents\ntoc-location: left\ncitation: true\nslug: stesiam2022\ntitle-block-banner: true\nnocite: '@*'\ncsl: apa-6th-edition\nbibliography: [packages.bib, references.bib]\nformat: \n  html:\n    code-link: true\n    code-fold: true\n    code-summary: \"Show the code\"\n    code-tools: \n      source: repo\nexecute:\n  echo: true\neditor_options: \n  markdown: \n    wrap: 80\n---\n\n\n# Table of Contents {.unlisted}\n\n<hr>\n1.  [Prerequisites](#prerequisites) <br>\n&nbsp; &nbsp;  1.1 [Import Libraries](#import-libraries) <br>\n&nbsp; &nbsp;  1.2 [Import Dataset](#import-dataset)\n&nbsp; &nbsp;  1.3 [Preview Dataset](#preview-dataset) <br>\n2.  [Making Map](#making-map) <br>\n&nbsp; &nbsp;  2.1 [Shapefile](#shapefile) <br>\n&nbsp; &nbsp;  2.2 [Visualization](#visualization) <br>\n3. [Total Railway Length](total-railway-length)<br>\n4. [Electrified Railway Length](#electrified-railway-length)<br>\n3.  [References](#references)\n\n<hr>\n\n# Prerequisites {#prerequisites}\n\n## Import Libraries {#import-libraries}\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# General purpose R libraries\nlibrary(dplyr)\nlibrary(readr)\nlibrary(kableExtra)\n\n# Data packages\n\nlibrary(eurostat)\n\n# Packages for maps\n\nlibrary(ggplot2)\nlibrary(sf)\n```\n:::\n\n\n\n\nFor this analysis we will need standard libraries for importing and processing\nmy data, such as readr [@R-readr] and dplyr [@R-dplyr]. The kableExtra\n[@R-kableExtra] package was used to print the results in table format. Also, I\nuse eurostat [@R-eurostat] package to analyze Eurostat data.\n\nIn order to make the visualization I will need (as\nalways) ggplot2 [@R-ggplot2] and sf [@R-sf].\n\n## Import dataset {#import-dataset}\n\n\n\n\n::: {.cell hash='2023-02-05-Railway-Transport-in-EU_cache/html/Import dataset_902528ed70eb747fb60a9f1a56084971'}\n\n```{.r .cell-code}\nrailway = read.csv(\"data/railtrack_data_eu.csv\")\n```\n:::\n\n\n## Preview Dataset {#preview-dataset}\n\n\n::: {.cell}\n\n```{.r .cell-code}\n#| label: tbl-preview-dataset\n#| tbl-cap: \"Preview Dataset (first 6 rows)\"\n#| \npreview_dataset = head(railway, 10)\nkbl(preview_dataset, \n    align = 'c',\n    booktabs = T,\n    centering = T,\n    valign = T) %>%\n  kable_paper() %>%\n  scroll_box(width = \"600px\", height = \"250px\")\n```\n\n::: {.cell-output-display}\n`````{=html}\n<div style=\"border: 1px solid #ddd; padding: 0px; overflow-y: scroll; height:250px; overflow-x: scroll; width:600px; \"><table class=\" lightable-paper\" style='font-family: \"Arial Narrow\", arial, helvetica, sans-serif; margin-left: auto; margin-right: auto;'>\n <thead>\n  <tr>\n   <th style=\"text-align:center;position: sticky; top:0; background-color: #FFFFFF;\"> DATAFLOW </th>\n   <th style=\"text-align:center;position: sticky; top:0; background-color: #FFFFFF;\"> LAST.UPDATE </th>\n   <th style=\"text-align:center;position: sticky; top:0; background-color: #FFFFFF;\"> freq </th>\n   <th style=\"text-align:center;position: sticky; top:0; background-color: #FFFFFF;\"> unit </th>\n   <th style=\"text-align:center;position: sticky; top:0; background-color: #FFFFFF;\"> tra_infr </th>\n   <th style=\"text-align:center;position: sticky; top:0; background-color: #FFFFFF;\"> geo </th>\n   <th style=\"text-align:center;position: sticky; top:0; background-color: #FFFFFF;\"> TIME_PERIOD </th>\n   <th style=\"text-align:center;position: sticky; top:0; background-color: #FFFFFF;\"> OBS_VALUE </th>\n   <th style=\"text-align:center;position: sticky; top:0; background-color: #FFFFFF;\"> OBS_FLAG </th>\n  </tr>\n </thead>\n<tbody>\n  <tr>\n   <td style=\"text-align:center;\"> ESTAT:RAIL_IF_TRACKS(1.0) </td>\n   <td style=\"text-align:center;\"> 30/01/23 23:00:00 </td>\n   <td style=\"text-align:center;\"> A </td>\n   <td style=\"text-align:center;\"> KM </td>\n   <td style=\"text-align:center;\"> RT_ELC </td>\n   <td style=\"text-align:center;\"> AL </td>\n   <td style=\"text-align:center;\"> 2013 </td>\n   <td style=\"text-align:center;\"> 0 </td>\n   <td style=\"text-align:center;\">  </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:center;\"> ESTAT:RAIL_IF_TRACKS(1.0) </td>\n   <td style=\"text-align:center;\"> 30/01/23 23:00:00 </td>\n   <td style=\"text-align:center;\"> A </td>\n   <td style=\"text-align:center;\"> KM </td>\n   <td style=\"text-align:center;\"> RT_ELC </td>\n   <td style=\"text-align:center;\"> AL </td>\n   <td style=\"text-align:center;\"> 2014 </td>\n   <td style=\"text-align:center;\"> 0 </td>\n   <td style=\"text-align:center;\">  </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:center;\"> ESTAT:RAIL_IF_TRACKS(1.0) </td>\n   <td style=\"text-align:center;\"> 30/01/23 23:00:00 </td>\n   <td style=\"text-align:center;\"> A </td>\n   <td style=\"text-align:center;\"> KM </td>\n   <td style=\"text-align:center;\"> RT_ELC </td>\n   <td style=\"text-align:center;\"> AL </td>\n   <td style=\"text-align:center;\"> 2015 </td>\n   <td style=\"text-align:center;\"> 0 </td>\n   <td style=\"text-align:center;\">  </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:center;\"> ESTAT:RAIL_IF_TRACKS(1.0) </td>\n   <td style=\"text-align:center;\"> 30/01/23 23:00:00 </td>\n   <td style=\"text-align:center;\"> A </td>\n   <td style=\"text-align:center;\"> KM </td>\n   <td style=\"text-align:center;\"> RT_ELC </td>\n   <td style=\"text-align:center;\"> AL </td>\n   <td style=\"text-align:center;\"> 2016 </td>\n   <td style=\"text-align:center;\"> 0 </td>\n   <td style=\"text-align:center;\">  </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:center;\"> ESTAT:RAIL_IF_TRACKS(1.0) </td>\n   <td style=\"text-align:center;\"> 30/01/23 23:00:00 </td>\n   <td style=\"text-align:center;\"> A </td>\n   <td style=\"text-align:center;\"> KM </td>\n   <td style=\"text-align:center;\"> RT_ELC </td>\n   <td style=\"text-align:center;\"> AL </td>\n   <td style=\"text-align:center;\"> 2017 </td>\n   <td style=\"text-align:center;\"> 0 </td>\n   <td style=\"text-align:center;\">  </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:center;\"> ESTAT:RAIL_IF_TRACKS(1.0) </td>\n   <td style=\"text-align:center;\"> 30/01/23 23:00:00 </td>\n   <td style=\"text-align:center;\"> A </td>\n   <td style=\"text-align:center;\"> KM </td>\n   <td style=\"text-align:center;\"> RT_ELC </td>\n   <td style=\"text-align:center;\"> AL </td>\n   <td style=\"text-align:center;\"> 2018 </td>\n   <td style=\"text-align:center;\"> 0 </td>\n   <td style=\"text-align:center;\">  </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:center;\"> ESTAT:RAIL_IF_TRACKS(1.0) </td>\n   <td style=\"text-align:center;\"> 30/01/23 23:00:00 </td>\n   <td style=\"text-align:center;\"> A </td>\n   <td style=\"text-align:center;\"> KM </td>\n   <td style=\"text-align:center;\"> RT_ELC </td>\n   <td style=\"text-align:center;\"> AL </td>\n   <td style=\"text-align:center;\"> 2019 </td>\n   <td style=\"text-align:center;\"> 0 </td>\n   <td style=\"text-align:center;\">  </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:center;\"> ESTAT:RAIL_IF_TRACKS(1.0) </td>\n   <td style=\"text-align:center;\"> 30/01/23 23:00:00 </td>\n   <td style=\"text-align:center;\"> A </td>\n   <td style=\"text-align:center;\"> KM </td>\n   <td style=\"text-align:center;\"> RT_ELC </td>\n   <td style=\"text-align:center;\"> AL </td>\n   <td style=\"text-align:center;\"> 2020 </td>\n   <td style=\"text-align:center;\"> 0 </td>\n   <td style=\"text-align:center;\">  </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:center;\"> ESTAT:RAIL_IF_TRACKS(1.0) </td>\n   <td style=\"text-align:center;\"> 30/01/23 23:00:00 </td>\n   <td style=\"text-align:center;\"> A </td>\n   <td style=\"text-align:center;\"> KM </td>\n   <td style=\"text-align:center;\"> RT_ELC </td>\n   <td style=\"text-align:center;\"> AL </td>\n   <td style=\"text-align:center;\"> 2021 </td>\n   <td style=\"text-align:center;\"> 0 </td>\n   <td style=\"text-align:center;\">  </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:center;\"> ESTAT:RAIL_IF_TRACKS(1.0) </td>\n   <td style=\"text-align:center;\"> 30/01/23 23:00:00 </td>\n   <td style=\"text-align:center;\"> A </td>\n   <td style=\"text-align:center;\"> KM </td>\n   <td style=\"text-align:center;\"> RT_ELC </td>\n   <td style=\"text-align:center;\"> BA </td>\n   <td style=\"text-align:center;\"> 2013 </td>\n   <td style=\"text-align:center;\"> 771 </td>\n   <td style=\"text-align:center;\">  </td>\n  </tr>\n</tbody>\n</table></div>\n\n`````\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\ndata = railway %>%\n  select(geo, TIME_PERIOD, OBS_VALUE, tra_infr) %>%\n  filter(TIME_PERIOD == 2021) %>%\n  filter(tra_infr == \"TOTAL\")\n\ndata_elec = railway %>%\n  select(geo, TIME_PERIOD, OBS_VALUE, tra_infr) %>%\n  filter(TIME_PERIOD == 2021) %>%\n  filter(tra_infr == \"RT_ELC\")\n```\n:::\n\n\n\n# Making Map\n\n## Shapefile\n\n\n::: {.cell}\n\n```{.r .cell-code}\nSHP_0 <- get_eurostat_geospatial(resolution = 10, \n                                 nuts_level = 0, \n                                 year = 2016)\n```\n\n::: {.cell-output .cell-output-stderr}\n```\nObject cached at /tmp/RtmpPOujz6/eurostat/sf10020164326.RData\n```\n:::\n\n::: {.cell-output .cell-output-stderr}\n```\nNo encoding supplied: defaulting to UTF-8.\n```\n:::\n\n::: {.cell-output .cell-output-stderr}\n```\nsf at resolution 1: 10  cached at:  /tmp/RtmpPOujz6/eurostat/sf10020164326.RData\n```\n:::\n\n::: {.cell-output .cell-output-stderr}\n```\nWarning in get_eurostat_geospatial(resolution = 10, nuts_level = 0, year =\n2016): Default of 'make_valid' for 'output_class=\"sf\"' will be changed in the\nfuture (see function details).\n```\n:::\n\n```{.r .cell-code}\nSHP_0 %>% \n  ggplot() +\n  geom_sf()\n```\n\n::: {.cell-output-display}\n![](2023-02-05-Railway-Transport-in-EU_files/figure-html/unnamed-chunk-3-1.png){width=672}\n:::\n:::\n\n\n\n## Visualization\n\n\n::: {.cell}\n\n```{.r .cell-code}\nEU27 <- eu_countries %>% \n  select(geo = code, name)\n\nSHP_27 <- SHP_0 %>% \n  select(geo = NUTS_ID, geometry) %>% \n  inner_join(EU27, by = \"geo\") %>% \n  arrange(geo) %>% \n  st_as_sf()\n\nSHP_27 %>% \n  ggplot(fill = values) +\n  geom_sf() +\n  scale_x_continuous(limits = c(-10, 35)) +\n  scale_y_continuous(limits = c(35, 65)) +\n    labs(\n    title = \"Railway Tracks\",\n    subtitle = \"Kilometers of railway tracks (in total, 2021)\",\n    caption = \"Data: Eurostat\"\n  ) +\n  theme_void() +\n  theme(\n    legend.position = c(0.97, 0.50)\n  )\n```\n\n::: {.cell-output-display}\n![](2023-02-05-Railway-Transport-in-EU_files/figure-html/unnamed-chunk-4-1.png){width=672}\n:::\n:::\n\n# Total Railway Length\n\n\n::: {.cell}\n\n```{.r .cell-code}\nrailway_shp = data %>%\n  select(geo, OBS_VALUE) %>%\n  inner_join(SHP_27, by = \"geo\") %>% \n  st_as_sf()\n```\n:::\n\n::: {.cell width='6'}\n\n```{.r .cell-code}\nrailway_shp  %>% \n  ggplot(aes(fill = OBS_VALUE)) +\n  geom_sf() +\n  geom_sf_text(aes(label = round((OBS_VALUE)/1000)),\n             colour = \"black\", \n             size = 4,\n             family=\"Liberation Serif\") +\n  # scale_fill_distiller(\n  #   palette = 13,\n  #   direction = 1   # reverse default order\n  # ) +\n  scale_fill_gradient(low='white', high='grey60') +\n  scale_x_continuous(limits = c(-10, 35)) +\n  scale_y_continuous(limits = c(35, 65)) +\n  theme_void() +\n    labs(\n    title = \"Railway Tracks (2021)\",\n    subtitle = \"Kilometers of railway tracks (in thousands kms) \",\n    caption = \"Data: Eurostat\",\n    fill = \"Observed\"\n  ) +\n  theme_void() +\n  theme(\n    legend.position = c(1, 0.50),\n    text=element_text(size=12,  family=\"Liberation Serif\")\n    )\n```\n\n::: {.cell-output .cell-output-stderr}\n```\nWarning in st_point_on_surface.sfc(sf::st_zm(x)): st_point_on_surface may not\ngive correct results for longitude/latitude data\n```\n:::\n\n::: {.cell-output-display}\n![](2023-02-05-Railway-Transport-in-EU_files/figure-html/unnamed-chunk-6-1.png){width=672}\n:::\n:::\n\n\n# Electrified Railway Length\n\n\n::: {.cell}\n\n```{.r .cell-code}\nrailway_shp = data_elec %>%\n  select(geo, OBS_VALUE) %>%\n  inner_join(SHP_27, by = \"geo\") %>% \n  st_as_sf()\n```\n:::\n\n::: {.cell width='6'}\n\n```{.r .cell-code}\nrailway_shp  %>% \n  ggplot(aes(fill = OBS_VALUE)) +\n  geom_sf() +\n  geom_sf_text(aes(label = round((OBS_VALUE)/1000)),\n             colour = \"black\", \n             size = 4,\n             family=\"Liberation Serif\") +\n  # scale_fill_distiller(\n  #   palette = 13,\n  #   direction = 1   # reverse default order\n  # ) +\n  scale_fill_gradient(low='white', high='yellow2') +\n  scale_x_continuous(limits = c(-10, 35)) +\n  scale_y_continuous(limits = c(35, 65)) +\n  theme_void() +\n    labs(\n    title = \"Electrified Railway Tracks (2021)\",\n    subtitle = \"Kilometers of railway tracks (in thousands kms)\",\n    caption = \"Data: Eurostat\",\n    fill = \"Observed\"\n  ) +\n  theme_void() +\n  theme(\n    legend.position = c(1, 0.50),\n    text=element_text(size=12,  family=\"Liberation Serif\")\n    )\n```\n\n::: {.cell-output .cell-output-stderr}\n```\nWarning in st_point_on_surface.sfc(sf::st_zm(x)): st_point_on_surface may not\ngive correct results for longitude/latitude data\n```\n:::\n\n::: {.cell-output-display}\n![](2023-02-05-Railway-Transport-in-EU_files/figure-html/unnamed-chunk-8-1.png){width=672}\n:::\n:::\n\n\n\n\n# Acknowledgements {.appendix .unlisted}\n\nImage by <a href=\"https://pixabay.com/users/fotoworkshop4you-2995268/?utm_source=link-attribution&amp;utm_medium=referral&amp;utm_campaign=image&amp;utm_content=1555348\">Martin Winkler</a> from <a href=\"https://pixabay.com//?utm_source=link-attribution&amp;utm_medium=referral&amp;utm_campaign=image&amp;utm_content=1555348\">Pixabay</a>\n\n# References {#references .appendix .unlisted}\n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {
      "include-in-header": [
        "<script src=\"../../site_libs/kePrint-0.0.1/kePrint.js\"></script>\n<link href=\"../../site_libs/lightable-0.0.1/lightable.css\" rel=\"stylesheet\" />\n"
      ]
    },
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}