---
title: "Railway Transport in EU"
author: "stesiam"
description: |
  An analysis on railway trasport in Europe.
categories: [R, Eurostat, EDA, Maps]
image: railway.jpg
fig-cap-location: bottom
date: "2023-02-05"
toc: true
toc-title: Table of contents
toc-location: left
citation: true
slug: stesiam2022
title-block-banner: true
nocite: '@*'
csl: apa-6th-edition
bibliography: [packages.bib, references.bib]
format: 
  html:
    code-link: true
    code-fold: true
    code-summary: "Show the code"
    code-tools: 
      source: repo
execute:
  echo: true
editor_options: 
  markdown: 
    wrap: 80
---

# Table of Contents {.unlisted}

<hr>
1.  [Prerequisites](#prerequisites) <br>
&nbsp; &nbsp;  1.1 [Import Libraries](#import-libraries) <br>
&nbsp; &nbsp;  1.2 [Import Dataset](#import-dataset)
&nbsp; &nbsp;  1.3 [Preview Dataset](#preview-dataset) <br>
2.  [Making Map](#making-map) <br>
&nbsp; &nbsp;  2.1 [Shapefile](#shapefile) <br>
&nbsp; &nbsp;  2.2 [Visualization](#visualization) <br>
3. [Total Railway Length](total-railway-length)<br>
4. [Electrified Railway Length](#electrified-railway-length)<br>
3.  [References](#references)

<hr>

# Prerequisites {#prerequisites}

## Import Libraries {#import-libraries}

```{r Import R Libraries, message=FALSE, results='hide', echo=TRUE}
# General purpose R libraries
library(dplyr)
library(readr)
library(kableExtra)

# Data packages

library(eurostat)

# Packages for maps

library(ggplot2)
library(sf)

```

```{r, include=FALSE}
knitr::write_bib(.packages(), file = 'packages.bib')
```

For this analysis we will need standard libraries for importing and processing
my data, such as readr [@R-readr] and dplyr [@R-dplyr]. The kableExtra
[@R-kableExtra] package was used to print the results in table format. Also, I
use eurostat [@R-eurostat] package to analyze Eurostat data.

In order to make the visualization I will need (as
always) ggplot2 [@R-ggplot2] and sf [@R-sf].

## Import dataset {#import-dataset}



```{r Import dataset, cache=TRUE, message=FALSE,results='hide',echo=TRUE, warning=FALSE}
railway = read.csv("data/railtrack_data_eu.csv")
```

## Preview Dataset {#preview-dataset}

```{r Preview Data}

#| label: tbl-preview-dataset
#| tbl-cap: "Preview Dataset (first 6 rows)"
#| 
preview_dataset = head(railway, 10)
kbl(preview_dataset, 
    align = 'c',
    booktabs = T,
    centering = T,
    valign = T) %>%
  kable_paper() %>%
  scroll_box(width = "600px", height = "250px")
```


```{r}
data = railway %>%
  select(geo, TIME_PERIOD, OBS_VALUE, tra_infr) %>%
  filter(TIME_PERIOD == 2021) %>%
  filter(tra_infr == "TOTAL")

data_elec = railway %>%
  select(geo, TIME_PERIOD, OBS_VALUE, tra_infr) %>%
  filter(TIME_PERIOD == 2021) %>%
  filter(tra_infr == "RT_ELC")
```


# Making Map

## Shapefile

```{r}
SHP_0 <- get_eurostat_geospatial(resolution = 10, 
                                 nuts_level = 0, 
                                 year = 2016)

SHP_0 %>% 
  ggplot() +
  geom_sf()
```


## Visualization

```{r}
EU27 <- eu_countries %>% 
  select(geo = code, name)

SHP_27 <- SHP_0 %>% 
  select(geo = NUTS_ID, geometry) %>% 
  inner_join(EU27, by = "geo") %>% 
  arrange(geo) %>% 
  st_as_sf()

SHP_27 %>% 
  ggplot(fill = values) +
  geom_sf() +
  scale_x_continuous(limits = c(-10, 35)) +
  scale_y_continuous(limits = c(35, 65)) +
    labs(
    title = "Railway Tracks",
    subtitle = "Kilometers of railway tracks (in total, 2021)",
    caption = "Data: Eurostat"
  ) +
  theme_void() +
  theme(
    legend.position = c(0.97, 0.50)
  )
```
# Total Railway Length

```{r}
railway_shp = data %>%
  select(geo, OBS_VALUE) %>%
  inner_join(SHP_27, by = "geo") %>% 
  st_as_sf()
```


```{r, width = 6}
railway_shp  %>% 
  ggplot(aes(fill = OBS_VALUE)) +
  geom_sf() +
  geom_sf_text(aes(label = round((OBS_VALUE)/1000)),
             colour = "black", 
             size = 4,
             family="Liberation Serif") +
  # scale_fill_distiller(
  #   palette = 13,
  #   direction = 1   # reverse default order
  # ) +
  scale_fill_gradient(low='white', high='grey60') +
  scale_x_continuous(limits = c(-10, 35)) +
  scale_y_continuous(limits = c(35, 65)) +
  theme_void() +
    labs(
    title = "Railway Tracks (2021)",
    subtitle = "Kilometers of railway tracks (in thousands kms) ",
    caption = "Data: Eurostat",
    fill = "Observed"
  ) +
  theme_void() +
  theme(
    legend.position = c(1, 0.50),
    text=element_text(size=12,  family="Liberation Serif")
    )
```

# Electrified Railway Length

```{r}
railway_shp = data_elec %>%
  select(geo, OBS_VALUE) %>%
  inner_join(SHP_27, by = "geo") %>% 
  st_as_sf()
```


```{r, width = 6}
railway_shp  %>% 
  ggplot(aes(fill = OBS_VALUE)) +
  geom_sf() +
  geom_sf_text(aes(label = round((OBS_VALUE)/1000)),
             colour = "black", 
             size = 4,
             family="Liberation Serif") +
  # scale_fill_distiller(
  #   palette = 13,
  #   direction = 1   # reverse default order
  # ) +
  scale_fill_gradient(low='white', high='yellow2') +
  scale_x_continuous(limits = c(-10, 35)) +
  scale_y_continuous(limits = c(35, 65)) +
  theme_void() +
    labs(
    title = "Electrified Railway Tracks (2021)",
    subtitle = "Kilometers of railway tracks (in thousands kms)",
    caption = "Data: Eurostat",
    fill = "Observed"
  ) +
  theme_void() +
  theme(
    legend.position = c(1, 0.50),
    text=element_text(size=12,  family="Liberation Serif")
    )
```



# Acknowledgements {.appendix .unlisted}

Image by <a href="https://pixabay.com/users/fotoworkshop4you-2995268/?utm_source=link-attribution&amp;utm_medium=referral&amp;utm_campaign=image&amp;utm_content=1555348">Martin Winkler</a> from <a href="https://pixabay.com//?utm_source=link-attribution&amp;utm_medium=referral&amp;utm_campaign=image&amp;utm_content=1555348">Pixabay</a>

# References {#references .appendix .unlisted}
